<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Portail QHSE Brignoles - ULTIME HD</title>
    
    <!-- Préchargement des polices pour éviter le flash -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;700;900&family=Rajdhani:wght@500;600;700;800;900&display=swap" rel="stylesheet">
    
    <!-- Bibliothèques -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        :root {
            --bg-dark: #050508;
            --sidebar-bg: rgba(10, 10, 15, 0.98);
            --card-glass: rgba(255, 255, 255, 0.03);
            --card-border: rgba(255, 255, 255, 0.08);
            --text-glow: 0 0 15px rgba(255,255,255,0.4);
            --sidebar-width: 320px;
            --ease-out-expo: cubic-bezier(0.19, 1, 0.22, 1);
        }

        /* RESET & BASE */
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-font-smoothing: antialiased; -webkit-tap-highlight-color: transparent; }
        
        body {
            font-family: 'Outfit', sans-serif;
            background-color: var(--bg-dark);
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(226, 0, 26, 0.05), transparent 40%), 
                radial-gradient(circle at 90% 80%, rgba(34, 197, 94, 0.05), transparent 40%);
            color: white;
            overflow: hidden;
            height: 100vh;
        }

        .font-rajdhani { font-family: 'Rajdhani', sans-serif; }

        /* --- LAYOUT --- */
        .app-container { display: flex; height: 100vh; position: relative; }

        /* SIDEBAR */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--sidebar-bg);
            border-right: 1px solid var(--card-border);
            display: flex;
            flex-direction: column;
            z-index: 60;
            backdrop-filter: blur(20px);
            transition: transform 0.4s var(--ease-out-expo);
            height: 100%;
            will-change: transform;
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }

        /* --- HEADER --- */
        header {
            height: 90px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 40px;
            background: linear-gradient(to bottom, rgba(5,5,8,0.95), transparent);
            z-index: 50;
            position: absolute;
            top: 0; left: 0; right: 0;
            pointer-events: none;
        }
        header > * { pointer-events: auto; }

        .mobile-menu-btn { display: none; }

        /* --- NAVIGATION --- */
        .nav-scroll { flex: 1; overflow-y: auto; padding: 25px; -webkit-overflow-scrolling: touch; }
        .nav-item {
            width: 100%;
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 14px 20px;
            border-radius: 16px;
            color: #999;
            font-weight: 700;
            transition: all 0.3s ease;
            border: 1px solid transparent;
            background: transparent;
            cursor: pointer;
            margin-bottom: 6px;
            font-family: 'Rajdhani', sans-serif;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 0.95rem;
        }
        .nav-item:hover { 
            background: rgba(255,255,255,0.04); 
            color: white; 
            transform: translateX(5px);
        }
        .nav-item.active { 
            background: linear-gradient(90deg, rgba(226, 0, 26, 0.15), transparent);
            border-left: 3px solid #E2001A;
            color: white; 
            text-shadow: var(--text-glow);
        }

        /* --- PUZZLE GRID --- */
        .content-padding { padding: 40px 60px; padding-top: 110px; padding-bottom: 60px; }
        
        .puzzle-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 30px;
            padding-top: 10px;
        }

        .puzzle-card {
            position: relative;
            height: 250px;
            background: var(--card-glass);
            border: 1px solid var(--card-border);
            border-radius: 24px;
            padding: 25px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            cursor: pointer;
            transition: transform 0.3s var(--ease-out-expo), background 0.3s ease;
            overflow: hidden;
            animation: cardEntry 0.6s var(--ease-out-expo) backwards;
            /* Optimisation GPU */
            transform: translate3d(0,0,0);
            backface-visibility: hidden;
        }

        .puzzle-card::before {
            content: '';
            position: absolute;
            inset: 0;
            background: var(--card-gradient);
            opacity: 0.1;
            z-index: 0;
            transition: opacity 0.4s ease;
        }

        .puzzle-card:hover {
            transform: translateY(-8px) scale(1.01);
            background: rgba(255,255,255,0.07);
            border-color: rgba(255,255,255,0.2);
            box-shadow: 0 20px 40px rgba(0,0,0,0.4);
            z-index: 10;
        }
        .puzzle-card:hover::before { opacity: 0.25; }

        /* ICON BOX */
        .card-icon-box {
            width: 95px;
            height: 95px;
            background: rgba(0,0,0,0.3);
            border-radius: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            border: 1px solid rgba(255,255,255,0.06);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            z-index: 2;
            transition: transform 0.4s var(--ease-out-expo);
            padding: 12px;
        }
        
        .puzzle-card:hover .card-icon-box {
            transform: scale(1.1) rotate(3deg);
            background: rgba(255,255,255,0.1);
            border-color: rgba(255,255,255,0.4);
        }

        .card-icon-box img { width: 100%; height: 100%; object-fit: contain; filter: drop-shadow(0 5px 10px rgba(0,0,0,0.5)); }
        .card-icon-box i { width: 42px; height: 42px; color: white; opacity: 0.9; }

        /* TEXTE */
        .card-title {
            font-family: 'Rajdhani', sans-serif;
            font-weight: 800;
            font-size: 1.35rem;
            text-transform: uppercase;
            color: white;
            z-index: 2;
            line-height: 1.1;
            text-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }
        
        .card-subtitle {
            font-size: 0.7rem;
            color: rgba(255,255,255,0.6);
            font-weight: 700;
            text-transform: uppercase;
            margin-top: 8px;
            letter-spacing: 2px;
            z-index: 2;
        }

        /* STATUS */
        .status-badge {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            z-index: 5;
        }
        .status-badge.online { background: #22c55e; box-shadow: 0 0 10px #22c55e; }
        .status-badge.folder { background: #fff; opacity: 0.3; }
        .status-badge.pending { background: #eab308; box-shadow: 0 0 10px #eab308; }

        /* SCROLLBAR */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.15); border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.3); }

        /* BUTTON BACK */
        .btn-back {
            width: 50px; height: 50px;
            border-radius: 16px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: all 0.3s ease;
        }
        .btn-back:hover { background: white; transform: translateX(-5px); color: black; }
        .btn-back:hover i { color: black; }

        /* --- MOBILE OPTIMIZATIONS (Max 1024px) --- */
        @media (max-width: 1024px) {
            .sidebar {
                position: fixed;
                left: 0; top: 0; bottom: 0;
                transform: translateX(-100%);
                box-shadow: 0 0 50px rgba(0,0,0,0.9);
            }
            .sidebar.open { transform: translateX(0); }
            
            .mobile-menu-btn {
                display: flex; align-items: center; justify-content: center;
                width: 45px; height: 45px;
                background: rgba(255,255,255,0.1);
                border-radius: 12px;
                border: 1px solid rgba(255,255,255,0.1);
                color: white; cursor: pointer;
                backdrop-filter: blur(10px);
            }

            .content-padding { padding: 20px; padding-top: 100px; padding-bottom: 40px; }
            header { padding: 0 20px; height: 80px; }
            
            /* Grille Mobile : 2 Colonnes */
            .puzzle-grid {
                grid-template-columns: repeat(2, 1fr); 
                gap: 15px;
            }
            .puzzle-card { height: 190px; padding: 15px; border-radius: 18px; }
            .card-icon-box { width: 65px; height: 65px; margin-bottom: 12px; border-radius: 16px; }
            .card-title { font-size: 0.9rem; }
            .card-subtitle { font-size: 0.55rem; }
            
            h2.text-6xl { font-size: 2.2rem; line-height: 1; }
            h2.text-5xl { font-size: 1.8rem; line-height: 1; }
        }

        @media (max-width: 400px) {
            .puzzle-grid { grid-template-columns: 1fr; } 
            .puzzle-card { height: 80px; flex-direction: row; text-align: left; justify-content: flex-start; gap: 15px; padding: 10px 20px; }
            .card-icon-box { margin-bottom: 0; width: 50px; height: 50px; border-radius: 12px; }
            .card-title { font-size: 1rem; }
            .card-subtitle { display: none; }
            .status-badge { top: 50%; transform: translateY(-50%); right: 20px; }
        }

        .overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 55;
            opacity: 0; pointer-events: none; transition: opacity 0.3s;
            backdrop-filter: blur(5px);
        }
        .overlay.active { opacity: 1; pointer-events: auto; }

        @keyframes cardEntry {
            0% { opacity: 0; transform: translateY(30px) scale(0.95); }
            100% { opacity: 1; transform: translateY(0) scale(1); }
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .animate-fade-in { animation: fadeIn 0.6s ease-out; }
    </style>
</head>
<body>

    <div class="app-container">
        <div class="overlay" id="overlay" onclick="toggleSidebar()"></div>

        <!-- SIDEBAR -->
        <aside class="sidebar" id="sidebar">
            <div class="p-8 border-b border-white/5 flex flex-col items-center gap-5 relative">
                <button onclick="toggleSidebar()" class="absolute top-4 right-4 lg:hidden text-white/50 hover:text-white transition-colors">
                    <i data-lucide="x"></i>
                </button>

                <!-- LOGO -->
                <div class="w-24 h-24 bg-white/10 rounded-2xl flex items-center justify-center shadow-[0_0_40px_rgba(255,255,255,0.1)] cursor-pointer hover:scale-105 transition-transform duration-500 backdrop-blur-md border border-white/10" onclick="renderHome()">
                    <img src="241111_Symbole R&B_320x320_RVB.png" class="w-full h-full object-contain p-2" alt="Logo">
                </div>
                <div class="text-center">
                    <h1 class="font-rajdhani font-black text-3xl uppercase leading-none tracking-tighter text-white">Brignoles</h1>
                    <span class="text-[10px] text-red-600 font-black tracking-[0.4em] uppercase mt-2 block shadow-red-glow">Logistique & QHSE</span>
                </div>
            </div>

            <div class="nav-scroll" id="nav-items"></div>

            <div class="p-5 text-[9px] text-zinc-600 font-bold text-center uppercase tracking-widest border-t border-white/5">
                &copy; 2026 Les Mousquetaires
            </div>
        </aside>

        <!-- MAIN CONTENT -->
        <main class="main-content">
            <header>
                <button class="mobile-menu-btn" onclick="toggleSidebar()">
                    <i data-lucide="menu"></i>
                </button>

                <div class="flex items-center gap-3 px-4 py-2 bg-green-500/10 border border-green-500/20 rounded-full ml-auto backdrop-blur-sm shadow-[0_0_15px_rgba(34,197,94,0.15)]">
                    <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse shadow-[0_0_10px_#22c55e]"></div>
                    <span class="text-[10px] font-black text-green-500 tracking-widest uppercase hidden sm:inline">Système En Ligne</span>
                    <span class="text-[10px] font-black text-green-500 tracking-widest uppercase sm:hidden">ON</span>
                </div>
            </header>

            <div class="flex-1 overflow-y-auto content-padding">
                <div class="max-w-[1800px] mx-auto" id="content-area"></div>
            </div>
        </main>
    </div>

    <!-- LOGIC -->
    <script>
        // --- 1. UI LOGIC ---
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');
            sidebar.classList.toggle('open');
            overlay.classList.toggle('active');
        }

        // --- 2. CONFIGURATION ---
        const THEME_GRADIENTS = {
            'PROCEDURES': 'linear-gradient(135deg, #E2001A 0%, #8B2635 100%)',
            'POI': 'linear-gradient(135deg, #FF7E5F 0%, #FEB47B 100%)',
            'RETRAIT': 'linear-gradient(135deg, #43cea2 0%, #185a9d 100%)',
            'FDS': 'linear-gradient(135deg, #bc4e9c 0%, #f80759 100%)',
            'EVALUATION': 'linear-gradient(135deg, #11998e 0%, #38ef7d 100%)',
            'REFERENTIELS': 'linear-gradient(135deg, #F2994A 0%, #F2C94C 100%)',
            'PERSONNEL': 'linear-gradient(135deg, #3E5151 0%, #DECBA4 100%)',
            'DECHETS': 'linear-gradient(135deg, #134E5E 0%, #71B280 100%)',
            'INDICATEURS': 'linear-gradient(135deg, #5C258D 0%, #4389A2 100%)',
            'AFFICHAGE': 'linear-gradient(135deg, #CAC531 0%, #F3F9A7 100%)',
            'FORMATION': 'linear-gradient(135deg, #834d9b 0%, #d04ed6 100%)',
            'AT': 'linear-gradient(135deg, #D38312 0%, #A83279 100%)',
            'REGLEMENTATION': 'linear-gradient(135deg, #000428 0%, #004e92 100%)',
            'COORDONNEES': 'linear-gradient(135deg, #e1eec3 0%, #f05053 100%)',
            'AUDIT': 'linear-gradient(135deg, #360033 0%, #0b8793 100%)',
            'INTERVENTION': 'linear-gradient(135deg, #c21500 0%, #ffc500 100%)',
            'REUNION': 'linear-gradient(135deg, #56ab2f 0%, #a8e063 100%)',
            'INCIDENT': 'linear-gradient(135deg, #870000 0%, #190A05 100%)',
            'COMMUNICATION': 'linear-gradient(135deg, #2c3e50 0%, #000000 100%)',
            'DEFAULT': 'linear-gradient(135deg, #232526 0%, #414345 100%)'
        };

        // --- 3. DATA CONTENT ---
        const PUZZLE_DATA = {
            PROCEDURES: {
                label: 'Procédures', icon: 'clipboard-list', image: 'liste.png',
                items: [
                    { type: 'section', label: 'Exploitation', items: [
                        { type: 'doc', title: 'Procédure Réception', code: 'BGN P REC 01', driveId: '1hEzOUg9OR24DBdY2eAvBJ1Pa8aNH68GD' },
                        { type: 'doc', title: 'Procédure Stockage', code: 'I REC 03', driveId: '1rJaLWE7t4vdD1DY87kuGyhWtP5yf8E1d' },
                        { type: 'doc', title: 'Procédure Préparation', code: 'BGN P PREP 01', driveId: '1eYQ79fzfVy1izWmBIKpIxtNRJSU0bCiq' },
                        { type: 'doc', title: 'Procédure Chargement', code: 'P CHA 01', driveId: '1BWzJZ8Cmk0GMKVWwA6WRuqAs7927xjxj' }
                    ]},
                    { type: 'section', label: 'Approvisionnement', items: [
                        { type: 'doc', title: 'Retour Fournisseur', code: 'P QUA 06', driveId: '1HIAzCX1hPTtTc9B9T0FQvfRi7pzuLSKY' },
                        { type: 'doc', title: 'Litiges Réception', code: 'N-P REC 03', driveId: '1beURHMLJOmQedGGlyzt7qSg2MLKkBnee' },
                        { type: 'doc', title: 'Gestion Casse', code: 'P QUA 10', driveId: '1IEeUPYRsneKfctMmQ4NsfBD89FUa6gym' }
                    ]},
                    { type: 'section', label: 'Transport', items: [
                        { type: 'doc', title: 'Procédure Livraison PDV', code: 'P TRA 01', driveId: '1xEJY4vFuZBkJRkCUAA3onmG5Wy3Q6VPi' },
                        { type: 'doc', title: 'Lavage Semis', code: 'BGN E TEC 01', driveId: '16UTFawlTvOFbSqz7BAfRQ0LzF4UlXB0c' },
                        { type: 'doc', title: 'Contrôle Ensemble Routier', code: 'E TRA 01', driveId: '1mO-18YX7pedS4L9pUsfnNQIep8ffL3X4' }
                    ]}
                ]
            },
            POI: {
                label: 'Incendie / POI', icon: 'flame', image: 'usine.png',
                items: [
                    { type: 'doc', title: 'Plan Organisation Interne (POI)', code: 'BGN D TEC 01.01', driveId: '10vb4M6NMW1HsWdk6gvW6PtPyTKLh6ToU' },
                    { type: 'doc', title: 'Fiche Réflexe POI Total', code: 'P TEC 03 bis', driveId: '1MfuYM0Hz8Dw_iVVAa9y4IJInDi8pof4M' }
                ]
            },
            RETRAIT: {
                label: 'Retrait Qualité', icon: 'truck', image: 'camion.png',
                items: [
                    { type: 'doc', title: 'Base de données Retrait Qualité', code: 'Dossier', driveId: '1-xdmXpSIzyQquASuRsP5LM1lhQpBHU8W' },
                    { type: 'doc', title: 'Procédure Retrait-Rappel', code: 'BGN P QUA 02.02', driveId: '1-DEbzeqNsGZblp1oO5YlHMabx9F4XgNP' }
                ]
            },
            FDS: {
                label: 'Fiches Sécurité', icon: 'flask-conical', image: 'pictogrammes supl.png',
                items: [
                    { type: 'doc', title: 'Base de données FDS', code: 'Liste Excel', driveId: '18kdUrV4bXU9510NrVT5urg-Xy1Abkzgu' },
                    { type: 'doc', title: 'SST: Que faire en cas de...', code: 'Guide SST', driveId: '1MDayqd50PnnJWFdn7JEBqVQ2UkjT8a3y' }
                ]
            },
            EVALUATION: {
                label: 'Évaluation', icon: 'target', image: 'cible.png',
                items: [
                    { type: 'section', label: 'Préparateurs', items: [
                        { type: 'doc', title: 'Évaluation Mensuelle Préparateurs', code: 'BGN P QUA 05', driveId: '1gkYO_SY3euReo6Rl5eU0YkwUbMZPYt7S' },
                        { type: 'doc', title: 'Fiche Interview Préparateur', code: 'Audit', driveId: '1CgBo-Tvo1zEa9vKKcC0fHrZEIyRVGUSk' }
                    ]}
                ]
            },
            REFERENTIELS: {
                label: 'Référentiels', icon: 'book-open', image: 'conseiller.png',
                items: [
                    { type: 'section', label: 'Hygiène & Propreté', items: [
                        { type: 'doc', title: 'Référentiel HP', code: 'ITM LAI', driveId: '1Gxy7j6nhdOJ0otdCnoDW1ZWSEGWSg_1G' }
                    ]},
                    { type: 'section', label: 'Certification', items: [
                        { type: 'doc', title: 'Référentiel EURACRP', code: 'ITM LAI', driveId: '1bZv-Pr4rEwYnfuprdD0L5jJEEww8DqWI' }
                    ]}
                ]
            },
            PERSONNEL: {
                label: 'Personnel', icon: 'users', image: 'ouvrier.png',
                items: [
                    { type: 'doc', title: 'Liste Personnel SST & EPI', code: 'BGN D RH 02', driveId: '1VZ6kgb8wBiDEiZ3hFP1oh-b0FQtyor2v' },
                    { type: 'doc', title: 'Membres CSSCT', code: 'D RHM 06', driveId: '1CJDCb_TLoWNohVFkG8rCBemznwPkPgNH' }
                ]
            },
            DECHETS: {
                label: 'Déchets', icon: 'recycle', image: 'légumes.png',
                items: [
                    { type: 'doc', title: 'Registre des Déchets', code: 'Dossier', driveId: '1QmUJfoVaBjoEEYgx9CS2Ei8Eno-VoHes' },
                    { type: 'doc', title: 'Instruction Tri des Déchets', code: 'BGN I ENV 01', driveId: '1ceAXwJWRiM_Ga9lykFvcK-EzEUGkCHiB' },
                    { type: 'doc', title: 'Mode Opératoire BSD', code: 'Instruction', driveId: '1o2iBS_xS4KESGdjcXCyR-qVzqiQVf-Eg' },
                    { type: 'doc', title: 'Affichage Tri Déchets', code: 'Visuel', driveId: '1_kr0amARa2w5XCuq71N8xO1OKEMjEM7d' }
                ]
            },
            INDICATEURS: {
                label: 'Indicateurs', icon: 'bar-chart-3', image: 'carte.png',
                items: [
                    { type: 'section', label: 'Certification', items: [
                        { type: 'doc', title: 'TDB Général Certification', code: 'Tableau', driveId: '1JieZdZEmeaLWPLy4EhsXRpGL4SuPJndu' }
                    ]},
                    { type: 'section', label: 'Exploitation', items: [
                        { type: 'doc', title: 'Productivité', code: 'TDB', driveId: '1OdHhYLwjxeTG1utu46jygCjsoJLfeXV4' },
                        { type: 'doc', title: 'Volumes', code: 'TDB', driveId: '1_kLJ6rXNj6_hgB5650u2IX1TaRx8mf5j' }
                    ]}
                ]
            },
            AFFICHAGE: {
                label: 'Affichage', icon: 'monitor', image: 'magasin.png',
                items: [
                    { type: 'doc', title: 'Lettre Engagement Direction QHSE', code: 'Affichage', driveId: '11ig6GN56VgdxbzdD1EJWIcWzupspPrNH' },
                    { type: 'doc', title: 'Zoom QHSE', code: 'Communication', driveId: '1UeBP8BaIs_wdOdZt7u7S0FPM9cb7AjCY' }
                ]
            },
            FORMATION: {
                label: 'Formation', icon: 'graduation-cap', image: 'mains.png',
                items: [
                    { type: 'section', label: 'Intégration', items: [
                        { type: 'doc', title: 'Programme Intégration', code: 'BGN P RH 02', driveId: '1b-gcwIhIPKqbAAA2RYJP7QJMj291mizW' }
                    ]},
                    { type: 'section', label: 'Autorisation Conduite', items: [
                        { type: 'doc', title: 'Formation AC Cat 1', code: 'Module 3', driveId: '1g9AHfajuW7dLlDSA2Ev6MgXZSnoMOy-E' }
                    ]}
                ]
            },
            AT: {
                label: 'Suivi AT', icon: 'activity', image: 'maison.png',
                items: [
                    { type: 'doc', title: 'Procédure Gestion AT', code: 'BGN P RH 03', driveId: '1LklxINTdKkfBmWKh2YVV0pexCCVPXc7k' },
                    { type: 'doc', title: 'Registre AT', code: 'Saisie', driveId: '1wAcHYoOaxrbP8m9ZDADUQboTZ8QObNPp' }
                ]
            },
            REGLEMENTATION: {
                label: 'Règlementation', icon: 'scale', image: 'liste.png',
                items: [
                    { type: 'section', label: 'Protocole Sécurité', items: [
                        { type: 'doc', title: 'Protocole Sécurité Base', code: 'BGN P SEC 01', driveId: '1Q7xYCSfUV4NvedKwJN8nm8ulYMh8bmVd' }
                    ]},
                    { type: 'section', label: 'Règlement Intérieur', items: [
                        { type: 'doc', title: 'Règlement Intérieur', code: 'Affichage', driveId: '17CcSYPEBMm-m3tW28k9CDrAVQRTp09sc' }
                    ]}
                ]
            },
            COORDONNEES: {
                label: 'Plans & Contacts', icon: 'map-pin', image: 'localisation.png',
                items: [
                    { type: 'section', label: 'Coordonnées PDV', items: [
                        { type: 'doc', title: 'Coordonnées PDV Brignoles', code: 'BGN D PDV 01', driveId: '1vXpse2pqzlLD6_sSkOzoKTz2aAPQIgJN' }
                    ]},
                    { type: 'section', label: 'Plans & Organigramme', items: [
                        { type: 'doc', title: 'Organigramme Brignoles', code: 'Structure', driveId: '1k3mjjaLtfQ109kdSliA_jj-AwRaN8wlU' },
                        { type: 'doc', title: 'Plans Site POI & Protocole', code: 'BGN D SEC 04', driveId: '1YW-o3xLrF0vx5bGHmlNe2oyvrNt2iW0u' }
                    ]}
                ]
            },
            AUDIT: {
                label: 'Audit', icon: 'search-code', image: 'conseiller.png',
                items: [
                    { type: 'section', label: 'Certification', items: [
                        { type: 'doc', title: 'Résultats Audit Certification', code: 'Dossier', driveId: '1WnfPUB2MEkbjo4IdX4a3BhY7phtKWHS0' }
                    ]}
                ]
            },
            INTERVENTION: {
                label: 'Intervention', icon: 'wrench', image: 'transpalette.png',
                items: [
                    { type: 'doc', title: 'Demandes Intervention Matériel', code: 'Registre', driveId: '1eJCmMlnG1DG9suNc0ycptexZNlKdegkV' },
                    { type: 'doc', title: 'Planning Lavage Semis', code: 'BGN E TEC 01', driveId: '1-tn_g6q6D5-sBCFLgoCuJzYyj336a-IG' }
                ]
            },
            REUNION: {
                label: 'CR Réunion', icon: 'message-square', image: 'ville.png',
                items: [
                    { type: 'doc', title: 'Point du Matin (PDM)', code: 'Dossier', driveId: '1FKqsw__ssCjXZzOjWOd5ZWA8gOzNSAT1' },
                    { type: 'doc', title: 'Réunion Exploitation', code: 'CR', driveId: '1MDNMfuCUoWLQ5aQDFNjMnLX_lXuInTcb' }
                ]
            },
            INCIDENT: {
                label: 'Incident', icon: 'alert-triangle', image: 'bateau.png',
                items: [
                    { type: 'doc', title: 'Compte Rendu Incident', code: 'BGN E RH 20', driveId: '1pxoiqFFPvo1TP7NEAfWE7dLSwNkKxt5P' },
                    { type: 'doc', title: 'Déclaration Incident', code: 'Formulaire', driveId: '1A5bIaZEAixeKb9QdbuPfvNWYpt5J9fz3' }
                ]
            },
            COMMUNICATION: {
                label: 'Com & Charte', icon: 'download', image: 'msqt-video-www-vignette.png',
                items: [
                    { type: 'section', label: 'Logos', items: [
                        { type: 'doc', title: 'Logo Signature CMJN', code: 'AI', driveId: '241015_Logo signature_CMJN.ai' },
                        { type: 'doc', title: 'Logo Signature RVB', code: 'AI', driveId: '241015_Logo signature_RVB.ai' },
                        { type: 'doc', title: 'Logo Signature Vectoriel', code: 'AI', driveId: '241021_Logo signature_FRA_RVB_VEC.ai' },
                        { type: 'doc', title: 'Symbole R&B 320px', code: 'PNG', driveId: '241111_Symbole R&B_320x320_RVB.png' },
                        { type: 'doc', title: 'Symbole R&B RVB', code: 'PSD', driveId: '241111_Symbole R&B_RVB.psd' },
                        { type: 'doc', title: 'Symbole R&V 320px', code: 'PNG', driveId: '241111_Symbole R&V_320x320_RVB.png' },
                        { type: 'doc', title: 'Symbole R&V RVB', code: 'PSD', driveId: '241111_Symbole R&V_RVB.psd' },
                        { type: 'doc', title: 'Symbole AI', code: 'AI', driveId: '241111_Symbole.ai' },
                        { type: 'doc', title: 'Symbole PDF', code: 'PDF', driveId: '241111_Symbole.pdf' },
                        { type: 'doc', title: 'Goupement V INV', code: 'AI', driveId: 'GROUPEMENT_MOUSQUETAIRES_V_INV_PANTONE.ai' },
                        { type: 'doc', title: 'Goupement V', code: 'AI', driveId: 'GROUPEMENT_MOUSQUETAIRES_V_PANTONE.ai' },
                        { type: 'doc', title: 'Signature HD', code: 'JPG', driveId: 'GROUP_MOUSQUETAIRES_SIGNATURE_HD.jpg' }
                    ]},
                    { type: 'section', label: 'PowerPoint', items: [
                        { type: 'doc', title: 'Masque PPT Clair', code: 'PPTX', driveId: 'MASQUE PPT VCLAIR 1.pptx' },
                        { type: 'doc', title: 'Masque PPT', code: 'PPTX', driveId: 'MASQUE PPT.pptx' },
                        { type: 'doc', title: 'Process Trame Com', code: 'PPTX', driveId: 'PROCESS TRAME DE COM.pptx' },
                        { type: 'doc', title: 'Couverture A1', code: 'JPG', driveId: 'PPT Couverture_A1.jpg' },
                        { type: 'doc', title: 'Couverture A2', code: 'JPG', driveId: 'PPT Couverture_A2.jpg' },
                        { type: 'doc', title: 'Couverture A3', code: 'JPG', driveId: 'PPT Couverture_A3.jpg' },
                        { type: 'doc', title: 'Couverture A4', code: 'JPG', driveId: 'PPT Couverture_A4.jpg' },
                        { type: 'doc', title: 'Couverture A5', code: 'JPG', driveId: 'PPT Couverture_A5.jpg' },
                        { type: 'doc', title: 'Interieur 1', code: 'JPG', driveId: 'PPT Interieur_1.jpg' },
                        { type: 'doc', title: 'Interieur 2', code: 'JPG', driveId: 'PPT Interieur_2.jpg' },
                        { type: 'doc', title: 'Interieur 3', code: 'JPG', driveId: 'PPT Interieur_3.jpg' },
                        { type: 'doc', title: 'Interieur 4', code: 'JPG', driveId: 'PPT Interieur_4.jpg' },
                        { type: 'doc', title: 'Interieur 5', code: 'JPG', driveId: 'PPT Interieur_5.jpg' }
                    ]},
                    { type: 'section', label: 'Signatures Mail', items: [
                        { type: 'doc', title: 'Signature Groupement', code: 'DOTX', driveId: 'Signature mail Groupement et autres entités.dotx' },
                        { type: 'doc', title: 'Signature SPDV', code: 'DOCX', driveId: 'Signature mail spécifique SPDV.docx' },
                        { type: 'doc', title: 'Modele TDL', code: 'DOTX', driveId: 'groupement_mousquetaires_tdl.dotx' }
                    ]}
                ]
            }
        };

        // --- 4. ENGINE ---
        function init() {
            renderSidebarNav();
            renderHome();
            lucide.createIcons();
        }

        function renderSidebarNav() {
            const nav = document.getElementById('nav-items');
            let html = `<button onclick="renderHomeWithClose()" class="nav-item active" data-nav="HOME">
                <i data-lucide="layout-grid"></i><span>Accueil</span>
            </button>`;
            
            Object.keys(PUZZLE_DATA).forEach(key => {
                const section = PUZZLE_DATA[key];
                html += `<button onclick="renderCategoryWithClose('${key}')" class="nav-item" data-nav="${key}">
                    <i data-lucide="${section.icon}"></i><span>${section.label}</span>
                </button>`;
            });
            nav.innerHTML = html;
        }

        function renderHomeWithClose() { renderHome(); closeSidebarMobile(); }
        function renderCategoryWithClose(key) { renderCategory(key); closeSidebarMobile(); }
        
        function closeSidebarMobile() {
            if(window.innerWidth <= 1024) {
                document.getElementById('sidebar').classList.remove('open');
                document.getElementById('overlay').classList.remove('active');
            }
        }

        function renderHome() {
            updateActiveNav('HOME');
            const container = document.getElementById('content-area');
            
            let html = `
                <div class="mb-8 lg:mb-12 animate-fade-in text-center lg:text-left">
                    <h2 class="text-4xl lg:text-7xl font-rajdhani font-black uppercase tracking-tighter text-white drop-shadow-lg">
                        Portail <span class="text-red-600">QHSE</span>
                    </h2>
                    <p class="text-zinc-500 font-bold text-xs lg:text-lg mt-2 uppercase tracking-[0.3em] opacity-80">Brignoles • Base Logistique</p>
                </div>
                <div class="puzzle-grid">
            `;

            let delay = 0;
            Object.keys(PUZZLE_DATA).forEach(key => {
                const data = PUZZLE_DATA[key];
                const gradient = THEME_GRADIENTS[key] || THEME_GRADIENTS.DEFAULT;
                
                html += createCardHTML({
                    title: data.label,
                    subtitle: 'DOSSIER',
                    icon: data.icon,
                    image: data.image,
                    gradient: gradient,
                    delay: delay,
                    onclick: `renderCategory('${key}')`,
                    status: 'folder'
                });
                delay += 30;
            });

            html += `</div>`;
            container.innerHTML = html;
            lucide.createIcons();
        }

        function renderCategory(key) {
            updateActiveNav(key);
            const data = PUZZLE_DATA[key];
            const gradient = THEME_GRADIENTS[key] || THEME_GRADIENTS.DEFAULT;
            
            buildGridPage({
                title: data.label,
                color: gradient,
                items: data.items,
                backAction: 'renderHome()',
                rootKey: key
            });
        }

        function renderSubCategory(rootKey, subLabel) {
            const rootData = PUZZLE_DATA[rootKey];
            const subData = rootData.items.find(i => i.label === subLabel);
            const gradient = THEME_GRADIENTS[rootKey];

            if(subData) {
                buildGridPage({
                    title: subLabel,
                    color: gradient,
                    items: subData.items,
                    backAction: `renderCategory('${rootKey}')`,
                    rootKey: rootKey
                });
            }
        }

        function buildGridPage({ title, color, items, backAction, rootKey }) {
            const container = document.getElementById('content-area');
            
            let html = `
                <div class="flex items-center gap-4 lg:gap-8 mb-8 lg:mb-12 animate-fade-in">
                    <button onclick="${backAction}" class="btn-back shrink-0">
                        <i data-lucide="arrow-left" class="w-6 h-6 text-white"></i>
                    </button>
                    <div>
                        <h2 class="text-3xl lg:text-6xl font-rajdhani font-black uppercase tracking-tight text-white leading-none drop-shadow-md">${title}</h2>
                        <div class="h-1 lg:h-1.5 w-16 lg:w-24 mt-2 rounded-full" style="background: ${color}"></div>
                    </div>
                </div>
                <div class="puzzle-grid">
            `;

            let delay = 0;
            if (items && items.length > 0) {
                items.forEach(item => {
                    if (item.type === 'section') {
                        html += createCardHTML({
                            title: item.label,
                            subtitle: 'SOUS-DOSSIER',
                            icon: 'folder-open',
                            gradient: color,
                            delay: delay,
                            onclick: `renderSubCategory('${rootKey}', '${item.label.replace(/'/g, "\\'")}')`,
                            status: 'folder'
                        });
                    } else {
                        // Empêche les liens vides de casser le site
                        if(!item.driveId) return;

                        const isPending = item.code === 'En cours';
                        let iconType = 'file-text';
                        const ext = item.code.toUpperCase();
                        
                        if(['AI', 'PSD'].includes(ext)) iconType = 'palette';
                        if(ext === 'PPTX') iconType = 'monitor';
                        if(['JPG', 'PNG'].includes(ext)) iconType = 'image';
                        if(ext === 'PDF') iconType = 'file';
                        if(['DOCX', 'DOTX'].includes(ext)) iconType = 'file-signature';
                        
                        html += createCardHTML({
                            title: item.title,
                            subtitle: item.code || 'DOCUMENT',
                            icon: isPending ? 'clock' : iconType,
                            gradient: isPending ? THEME_GRADIENTS.DEFAULT : color,
                            delay: delay,
                            onclick: isPending ? '' : `window.open('${item.driveId}', '_blank')`,
                            status: isPending ? 'pending' : 'online'
                        });
                    }
                    delay += 30;
                });
            } else {
                html += `<div class="col-span-full text-center text-zinc-500 py-20 font-bold uppercase tracking-widest text-sm opacity-50">Aucun élément disponible</div>`;
            }

            html += `</div>`;
            container.innerHTML = html;
            lucide.createIcons();
        }

        function createCardHTML({ title, subtitle, icon, image, gradient, delay, onclick, status }) {
            let statusHtml = '';
            if(status === 'online') statusHtml = `<div class="status-badge online" title="En ligne"></div>`;
            if(status === 'pending') statusHtml = `<div class="status-badge pending" title="En cours"></div>`;
            
            // Logique de fallback d'image robuste
            const content = image 
                ? `<img src="${image}" alt="${title}" onerror="this.style.display='none'; this.nextElementSibling.style.display='block'"> <i data-lucide="${icon}" style="display:none"></i>`
                : `<i data-lucide="${icon}"></i>`;

            return `
                <div class="puzzle-card" 
                     style="--card-gradient: ${gradient}; animation-delay: ${delay}ms"
                     onclick="${onclick}">
                    ${statusHtml}
                    <div class="card-icon-box">
                        ${content}
                    </div>
                    <div class="card-title line-clamp-2">${title}</div>
                    <div class="card-subtitle">${subtitle}</div>
                </div>
            `;
        }

        function updateActiveNav(key) {
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            const active = document.querySelector(`[data-nav="${key}"]`);
            if (active) active.classList.add('active');
        }

        window.onload = init;

    </script>
</body>
</html>