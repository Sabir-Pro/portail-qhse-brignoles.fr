<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Les Mousquetaires - Portail QHSE Brignoles</title>

  <!-- SEO & Meta -->
  <meta name="description" content="Portail QHSE Les Mousquetaires - Base logistique de Brignoles" />
  <meta name="theme-color" content="#E2001A" />
  <link rel="icon" type="image/png" href="241111_Symbole R&B_320x320_RVB.png" />
  <link rel="apple-touch-icon" href="241111_Symbole R&B_320x320_RVB.png" />

  <!-- Fonts optimis√©s -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700;900&family=Outfit:wght@300;400;600;700;900&display=swap" rel="stylesheet" />

  <style>
    :root {
      --primary: #E2001A;
      --primary-dark: #b00015;
      --primary-glow: rgba(226, 0, 26, 0.6);
      --bg-deep: #020203;
      --border: rgba(255, 255, 255, 0.12);
      --border-light: rgba(255, 255, 255, 0.08);
      --text-main: #ffffff;
      --text-dim: #a8a8a8;

      --sidebar-width: 300px;
      --header-height: 90px;
      --transition: 0.35s ease;
    }

    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Outfit', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background-color: var(--bg-deep);
      color: var(--text-main);
      overflow: hidden;
      height: 100vh;
      width: 100vw;
      position: relative;
      line-height: 1.6;
    }

    ::selection { background: var(--primary); color: white; }

    body::before {
      content: "";
      position: fixed;
      inset: 0;
      background: url("PPT Couverture_D3.jpg") center/cover no-repeat;
      opacity: 0.22;
      filter: saturate(0.92) contrast(1.08) brightness(0.95);
      z-index: -5;
      pointer-events: none;
      animation: subtleZoom 35s ease-in-out infinite alternate;
    }
    @keyframes subtleZoom { 0% { transform: scale(1); } 100% { transform: scale(1.08) translateX(-20px); } }

    body::after {
      content: "";
      position: fixed;
      inset: 0;
      background:
        radial-gradient(ellipse 800px 600px at 25% 15%, rgba(226, 0, 26, 0.08), transparent 60%),
        linear-gradient(180deg, rgba(0,0,0,0.72), rgba(0,0,0,0.94));
      z-index: -4;
      pointer-events: none;
    }

    #bg-grid {
      position: fixed;
      inset: 0;
      background-image:
        repeating-linear-gradient(0deg, rgba(255, 255, 255, 0.03) 0px, transparent 1px, transparent 60px),
        repeating-linear-gradient(90deg, rgba(255, 255, 255, 0.03) 0px, transparent 1px, transparent 60px);
      transform: perspective(700px) rotateX(60deg) translateY(-150px) translateZ(-250px);
      animation: gridFlow 30s linear infinite;
      z-index: -3;
      pointer-events: none;
      opacity: 0.5;
    }
    @keyframes gridFlow {
      0% { transform: perspective(700px) rotateX(60deg) translateY(0) translateZ(-250px); }
      100% { transform: perspective(700px) rotateX(60deg) translateY(60px) translateZ(-250px); }
    }

    /* LOADING */
    .loading-overlay {
      position: fixed;
      inset: 0;
      background: var(--bg-deep);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10000;
      opacity: 1;
      transition: opacity 0.5s ease;
    }
    .loading-overlay.hidden { opacity: 0; pointer-events: none; }
    .spinner {
      width: 60px;
      height: 60px;
      border: 4px solid rgba(255, 255, 255, 0.1);
      border-top-color: var(--primary);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* LAYOUT */
    .app { display: flex; height: 100vh; width: 100%; opacity: 0; transition: opacity 0.6s ease; }
    .app.loaded { opacity: 1; }

    /* SIDEBAR */
    .sidebar {
      width: var(--sidebar-width);
      background: linear-gradient(180deg, rgba(10, 10, 15, 0.97), rgba(5, 5, 10, 0.99));
      border-right: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      z-index: 100;
      backdrop-filter: blur(25px) saturate(150%);
    }

    .brand-box {
      padding: 30px 26px;
      display: flex;
      align-items: center;
      gap: 18px;
      border-bottom: 1px solid var(--border);
      background: rgba(0, 0, 0, 0.35);
    }

    .brand-logo {
      width: 64px;
      height: 64px;
      object-fit: contain;
      border-radius: 16px;
      cursor: pointer;
      filter: drop-shadow(0 10px 25px rgba(226, 0, 26, 0.5));
      transition: var(--transition);
    }
    .brand-logo:hover { transform: scale(1.08) rotate(-6deg); }

    .brand-text h2 {
      font-family: 'Rajdhani', sans-serif;
      font-weight: 900;
      font-size: 22px;
      line-height: 1;
      letter-spacing: 1.2px;
      text-transform: uppercase;
      color: #fff;
    }
    .brand-text span {
      font-size: 11px;
      color: var(--text-dim);
      display: block;
      margin-top: 7px;
      letter-spacing: 0.8px;
      font-weight: 500;
    }

    .menu { flex: 1; overflow-y: auto; padding: 26px 20px; }
    .menu::-webkit-scrollbar { width: 5px; }
    .menu::-webkit-scrollbar-thumb { background: var(--primary); border-radius: 3px; }

    .nav-link {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 18px 20px;
      color: var(--text-dim);
      border-radius: 15px;
      margin-bottom: 12px;
      transition: var(--transition);
      border: 1px solid transparent;
      font-family: 'Rajdhani', sans-serif;
      font-size: 17px;
      font-weight: 700;
      cursor: pointer;
      user-select: none;
    }
    .nav-link:hover { background: rgba(255,255,255,0.09); color: #fff; transform: translateX(6px); }
    .nav-link.active {
      background: linear-gradient(135deg, rgba(226,0,26,0.28), rgba(226,0,26,0.12));
      border-left: 4px solid var(--primary);
      color: white;
      transform: translateX(6px);
    }

    .nav-icon { width: 30px; height: 30px; object-fit: contain; flex-shrink: 0; }

    /* MAIN */
    .main-content { flex: 1; display: flex; flex-direction: column; overflow: hidden; }

    .topbar {
      height: var(--header-height);
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 50px;
      border-bottom: 1px solid var(--border);
      background: rgba(10, 10, 15, 0.92);
      backdrop-filter: blur(25px) saturate(150%);
      position: sticky;
      top: 0;
      z-index: 90;
    }

    .page-title { display: flex; align-items: center; gap: 18px; }
    .topbar-logo { width: 42px; height: 42px; object-fit: contain; }

    .page-title h2 {
      font-size: 30px;
      font-weight: 900;
      color: white;
      font-family: 'Rajdhani', sans-serif;
      text-transform: uppercase;
      letter-spacing: 1.5px;
    }

    .btn-icon {
      width: 52px; height: 52px;
      border-radius: 16px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.06);
      display: flex; align-items: center; justify-content: center;
      cursor: pointer;
      transition: var(--transition);
    }
    .btn-icon:hover { background: var(--primary); transform: translateY(-3px); }
    .btn-icon img { width: 26px; height: 26px; object-fit: contain; }

    .scroll-area {
      flex: 1;
      overflow-y: auto;
      overflow-x: hidden;
      padding: 55px;
      scroll-behavior: smooth;
    }

    .page { display: none; }
    .page.active { display: block; animation: pageEntrance 0.5s ease; }
    @keyframes pageEntrance { from { opacity: 0; transform: translateY(25px); } to { opacity: 1; transform: translateY(0); } }

    /* PUZZLE */
    .puzzle-wrapper { display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: calc(100vh - 250px); padding: 30px; }
    .puzzle-header { text-align: center; margin-bottom: 40px; }
    .puzzle-header .emoji { font-size: 70px; display: block; margin-bottom: 15px; }
    .puzzle-header h1 {
      font-size: 56px;
      font-weight: 900;
      color: #fff;
      letter-spacing: 2px;
      font-family: 'Rajdhani', sans-serif;
    }

    .puzzle-container {
      max-width: 1150px;
      width: 100%;
      aspect-ratio: 5/4;
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      grid-template-rows: repeat(4, 1fr);
      overflow: hidden;
      border-radius: 18px;
      box-shadow: 0 35px 90px rgba(0,0,0,0.6);
      border: 1px solid rgba(255,255,255,0.06);
    }

    .puzzle-piece {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 14px;
      font-family: 'Rajdhani', sans-serif;
      font-weight: 900;
      font-size: clamp(11px, 1.35vw, 18px);
      text-transform: uppercase;
      letter-spacing: 0.7px;
      color: white;
      cursor: pointer;
      transition: 0.25s ease;
      user-select: none;
      border: 1px solid rgba(0,0,0,0.12);
    }
    .puzzle-piece:hover { filter: brightness(1.08); transform: scale(1.02); z-index: 2; }

    .p-icon { width: 34px; height: 34px; object-fit: contain; margin-bottom: 10px; }

    .p-red { background: linear-gradient(135deg, #e10600 0%, #b00015 100%); }
    .p-cyan { background: linear-gradient(135deg, #20c997 0%, #17a07a 100%); }
    .p-orange { background: linear-gradient(135deg, #ffb02e 0%, #e09500 100%); }
    .p-gray { background: linear-gradient(135deg, #5c5c5c 0%, #3a3a3a 100%); }
    .p-teal { background: linear-gradient(135deg, #0f6a5a 0%, #094538 100%); }
    .p-blue { background: linear-gradient(135deg, #1f4bff 0%, #1235cc 100%); }
    .p-yellow { background: linear-gradient(135deg, #f7f17a 0%, #e0d050 100%); color: #1a1a1a; }
    .p-magenta { background: linear-gradient(135deg, #b800ff 0%, #8e00cc 100%); }
    .p-lime { background: linear-gradient(135deg, #8bd84c 0%, #68b02e 100%); }
    .p-purple { background: linear-gradient(135deg, #6a7cff 0%, #4a5acc 100%); }
    .p-pink { background: linear-gradient(135deg, #ff3bb2 0%, #cc2888 100%); }
    .p-aqua { background: linear-gradient(135deg, #00d0ff 0%, #00a3cc 100%); }
    .p-lightyellow { background: linear-gradient(135deg, #f3e401 0%, #c4b500 100%); color: #1a1a1a; }
    .p-darkpurple { background: linear-gradient(135deg, #582f93 0%, #3a1f63 100%); }
    .p-lightpurple { background: linear-gradient(135deg, #8a9cff 0%, #6875cc 100%); }
    .p-wine { background: linear-gradient(135deg, #7a0026 0%, #55001a 100%); }
    .p-lightgray { background: linear-gradient(135deg, #dfe3ff 0%, #bac0dd 100%); color: #1a1a1a; }
    .p-darkred { background: linear-gradient(135deg, #e10600 0%, #980400 100%); }
    .p-green { background: linear-gradient(135deg, #00b894 0%, #008f6f 100%); }

    /* DOC GRID */
    .doc-grid { display: grid; gap: 18px; width: 100%; max-width: 1000px; }
    .doc-item {
      background: rgba(255,255,255,0.045);
      border: 1px solid var(--border-light);
      border-radius: 16px;
      padding: 22px;
      cursor: pointer;
      transition: 0.2s ease;
    }
    .doc-item:hover { background: rgba(255,255,255,0.075); transform: translateY(-2px); }
    .doc-item h4 {
      font-size: 18px;
      font-weight: 900;
      color: white;
      margin-bottom: 6px;
      text-transform: uppercase;
      font-family: 'Rajdhani', sans-serif;
      letter-spacing: 0.6px;
    }
    .doc-item p { font-size: 14px; color: var(--text-dim); }

    /* MODAL DOC VIEWER */
    .modal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.88);
      backdrop-filter: blur(12px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 24px;
    }
    .modal.active { display: flex; }

    .modal-content {
      width: 100%;
      max-width: 1200px;
      background: linear-gradient(180deg, rgba(20,20,25,0.98), rgba(10,10,15,0.98));
      border: 1px solid var(--border);
      border-radius: 22px;
      overflow: hidden;
      box-shadow: 0 45px 120px rgba(0,0,0,0.9);
    }

    .modal-header {
      padding: 18px 22px;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      gap: 14px;
      background: rgba(0,0,0,0.35);
    }
    .modal-header .emoji { font-size: 32px; }
    .modal-header h2 {
      font-size: 22px;
      font-weight: 900;
      font-family: 'Rajdhani', sans-serif;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    .modal-actions { margin-left: auto; display: flex; gap: 10px; align-items: center; }

    .modal-btn {
      background: rgba(255,255,255,0.08);
      border: 1px solid var(--border);
      color: white;
      padding: 10px 14px;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 800;
      font-family: 'Rajdhani', sans-serif;
      text-transform: uppercase;
      font-size: 13px;
      letter-spacing: 0.6px;
      transition: 0.2s ease;
      white-space: nowrap;
    }
    .modal-btn:hover { background: rgba(255,255,255,0.14); }

    .modal-body { display: grid; grid-template-columns: 420px 1fr; min-height: 70vh; }
    .modal-left { border-right: 1px solid var(--border); padding: 16px; overflow: auto; }
    .modal-right { padding: 16px; overflow: hidden; display: flex; flex-direction: column; gap: 10px; }

    .search {
      width: 100%;
      padding: 12px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(255,255,255,0.06);
      color: white;
      outline: none;
      margin-bottom: 10px;
    }

    .doc-list { display: grid; gap: 10px; }
    .doc-row {
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(255,255,255,0.045);
      border-radius: 14px;
      padding: 12px 12px;
      cursor: pointer;
      transition: 0.2s ease;
    }
    .doc-row:hover { background: rgba(255,255,255,0.075); transform: translateY(-1px); }
    .doc-row strong { display: block; font-family: 'Rajdhani', sans-serif; letter-spacing: 0.5px; }
    .doc-row small { color: var(--text-dim); }

    .viewer-bar { display: flex; gap: 10px; flex-wrap: wrap; }
    .viewer-title { font-family: 'Rajdhani', sans-serif; font-weight: 900; letter-spacing: 0.6px; }
    .viewer-frame {
      border: 1px solid rgba(255,255,255,0.10);
      border-radius: 14px;
      overflow: hidden;
      flex: 1;
      min-height: 56vh;
      background: rgba(255,255,255,0.03);
    }
    iframe { width: 100%; height: 100%; border: none; }

    /* TOAST */
    .toast {
      position: fixed;
      bottom: 30px;
      right: 30px;
      background: linear-gradient(135deg, rgba(226,0,26,0.95), rgba(176,0,21,0.95));
      color: white;
      padding: 16px 22px;
      border-radius: 14px;
      z-index: 10001;
      opacity: 0;
      transform: translateY(20px);
      transition: 0.25s ease;
      pointer-events: none;
      font-family: 'Rajdhani', sans-serif;
      font-weight: 700;
      border: 1px solid rgba(255,255,255,0.18);
      max-width: 520px;
    }
    .toast.show { opacity: 1; transform: translateY(0); }

    /* MOBILE */
    @media (max-width: 1024px) {
      :root { --sidebar-width: 100%; --header-height: 70px; }
      .app { flex-direction: column; }

      .sidebar {
        position: fixed;
        bottom: 0; left: 0;
        width: 100%;
        height: 80px;
        flex-direction: row;
        align-items: center;
        padding: 0;
        border-top: 2px solid var(--primary);
        border-right: none;
        justify-content: space-around;
        background: rgba(5,5,5,0.99);
        z-index: 1001;
      }
      .brand-box { display: none; }
      .menu { display: flex; flex-direction: row; padding: 0; width: 100%; justify-content: space-around; align-items: center; gap: 4px; }
      .nav-link { flex-direction: column; gap: 6px; font-size: 11px; padding: 10px 6px; border: none; margin: 0; background: transparent !important; width: 78px; justify-content: center; }
      .main-content { margin-bottom: 80px; height: calc(100vh - 80px); }
      .topbar { padding: 0 18px; }

      .puzzle-container { grid-template-columns: repeat(3, 1fr); grid-template-rows: auto; aspect-ratio: auto; }

      .modal-body { grid-template-columns: 1fr; }
      .modal-left { border-right: none; border-bottom: 1px solid var(--border); }
      .viewer-frame { min-height: 50vh; }
      .toast { bottom: 100px; right: 20px; left: 20px; text-align: center; }
    }
  </style>
</head>

<body>
  <!-- LOADING OVERLAY -->
  <div class="loading-overlay" id="loading">
    <div class="spinner"></div>
  </div>

  <div id="bg-grid"></div>

  <div class="app" id="app">
    <!-- SIDEBAR -->
    <nav class="sidebar">
      <div class="brand-box">
        <img class="brand-logo"
             src="GROUPEMENT_MOUSQUETAIRES_H_INV_HD.png"
             alt="Groupement Mousquetaires"
             onclick="nav('puzzle', document.querySelectorAll('.nav-link')[0])"
             data-fallback="241111_Symbole R&B_320x320_RVB.png">

        <div class="brand-text">
          <h2>BRIGNOLES</h2>
          <span>LOGISTIQUE &amp; QHSE</span>
        </div>
      </div>

      <div class="menu">
        <div class="nav-link active" onclick="nav('puzzle', this)">
          <img class="nav-icon" src="liste.png" alt="Puzzle" loading="lazy" data-fallback="liste.png">
          <span>Puzzle QHSE</span>
        </div>

        <div class="nav-link" onclick="nav('poi', this)">
          <img class="nav-icon" src="usine.png" alt="Incendie" loading="lazy" data-fallback="usine.png">
          <span>Incendie</span>
        </div>

        <div class="nav-link" onclick="nav('retrait', this)">
          <img class="nav-icon" src="chariot.png" alt="Retrait" loading="lazy" data-fallback="carton.png">
          <span>Retrait</span>
        </div>

        <div class="nav-link" onclick="nav('fds', this)">
          <img class="nav-icon" src="cible.png" alt="FDS" loading="lazy" data-fallback="cible.png">
          <span>FDS</span>
        </div>

        <div class="nav-link" onclick="nav('reglementation', this)">
          <img class="nav-icon" src="liste.png" alt="R√®glement" loading="lazy" data-fallback="liste.png">
          <span>R√®glement</span>
        </div>
      </div>
    </nav>

    <!-- MAIN -->
    <main class="main-content">
      <header class="topbar">
        <div class="page-title">
          <img class="topbar-logo" src="241111_Symbole R&B_320x320_RVB.png" alt="Logo" loading="lazy" data-fallback="241111_Symbole R&B_320x320_RVB.png">
          <h2 id="title-display">Puzzle QHSE</h2>
        </div>

        <div class="actions">
          <div class="btn-icon" title="Retour √† l'accueil" onclick="nav('puzzle', document.querySelectorAll('.nav-link')[0])">
            <img src="maison.png" alt="Accueil" loading="lazy" data-fallback="maison.png">
          </div>
        </div>
      </header>

      <div class="scroll-area">
        <!-- PAGE PUZZLE -->
        <div id="puzzle" class="page active">
          <div class="puzzle-wrapper">
            <div class="puzzle-header">
              <span class="emoji">üß©</span>
              <h1>ACCUEIL</h1>
            </div>

            <div class="puzzle-container">
              <!-- IMPORTANT: maintenant TOUT ouvre la m√™me liste Drive,
                   tu peux ensuite trier/cat√©goriser si tu veux -->
              <div class="puzzle-piece p-red" onclick="openDriveModal('üìã', 'PROCEDURES')">
                <img class="p-icon" src="liste.png" alt="" loading="lazy" data-fallback="liste.png">
                PROCEDURES
              </div>

              <div class="puzzle-piece p-cyan" onclick="openDriveModal('üìä', 'EVALUATION')">
                <img class="p-icon" src="cible.png" alt="" loading="lazy" data-fallback="cible.png">
                EVALUATION
              </div>

              <div class="puzzle-piece p-orange" onclick="openDriveModal('üìö', 'REFERENTIELS')">
                <img class="p-icon" src="liste.png" alt="" loading="lazy" data-fallback="liste.png">
                REFERENTIELS
              </div>

              <div class="puzzle-piece p-gray" onclick="openDriveModal('üë•', 'LISTE PERSONNEL')">
                <img class="p-icon" src="mains.png" alt="" loading="lazy" data-fallback="mains.png">
                LISTE PERSONNEL<br>AFFICHAGE
              </div>

              <div class="puzzle-piece p-teal" onclick="openDriveModal('‚ôªÔ∏è', 'SUIVI DES DECHETS')">
                <img class="p-icon" src="camion.png" alt="" loading="lazy" data-fallback="camion.png">
                SUIVI DES DECHETS
              </div>

              <div class="puzzle-piece p-blue" onclick="openDriveModal('üìà', 'INDICATEURS')">
                <img class="p-icon" src="ville.png" alt="" loading="lazy" data-fallback="ville.png">
                INDICATEURS
              </div>

              <div class="puzzle-piece p-yellow" onclick="openDriveModal('üì∫', 'AFFICHAGE')">
                <img class="p-icon" src="magasin.png" alt="" loading="lazy" data-fallback="magasin.png">
                AFFICHAGE
              </div>

              <div class="puzzle-piece p-magenta" onclick="openDriveModal('üéì', 'FORMATION')">
                <img class="p-icon" src="conseiller.png" alt="" loading="lazy" data-fallback="conseiller.png">
                FORMATION
              </div>

              <div class="puzzle-piece p-lime" onclick="openDriveModal('üè•', 'SUIVI DES AT')">
                <img class="p-icon" src="ouvrier.png" alt="" loading="lazy" data-fallback="ouvrier.png">
                SUIVI DES AT
              </div>

              <div class="puzzle-piece p-purple" onclick="openDriveModal('‚öñÔ∏è', 'REGLEMENTATION')">
                <img class="p-icon" src="liste.png" alt="" loading="lazy" data-fallback="liste.png">
                REGLEMENTATION
              </div>

              <div class="puzzle-piece p-pink" onclick="openDriveModal('üó∫Ô∏è', 'COORDONNEES & PLAN')">
                <img class="p-icon" src="localisation.png" alt="" loading="lazy" data-fallback="localisation.png">
                COORDONNEES &<br>PLAN
              </div>

              <div class="puzzle-piece p-aqua" onclick="openDriveModal('üîç', 'REVUE DIRECTION & AUDIT')">
                <img class="p-icon" src="cible.png" alt="" loading="lazy" data-fallback="cible.png">
                REVUE DIRECTION<br>& AUDIT
              </div>

              <div class="puzzle-piece p-lightyellow" onclick="openDriveModal('üõ†Ô∏è', 'INTERVENTION')">
                <img class="p-icon" src="transpalette.png" alt="" loading="lazy" data-fallback="transpalette.png">
                INTERVENTION
              </div>

              <div class="puzzle-piece p-darkpurple" onclick="openDriveModal('üí¨', 'CR REUNION')">
                <img class="p-icon" src="mains.png" alt="" loading="lazy" data-fallback="mains.png">
                CR REUNION
              </div>

              <div class="puzzle-piece p-lightpurple" onclick="openDriveModal('‚öñÔ∏è', 'REGLEMENTATION (2)')">
                <img class="p-icon" src="liste.png" alt="" loading="lazy" data-fallback="liste.png">
                REGLEMENTATION
              </div>

              <div class="puzzle-piece p-wine" onclick="nav('retrait', document.querySelectorAll('.nav-link')[2])">
                <img class="p-icon" src="chariot.png" alt="" loading="lazy" data-fallback="carton.png">
                RETRAIT<br>QUALITE
              </div>

              <div class="puzzle-piece p-red" onclick="nav('poi', document.querySelectorAll('.nav-link')[1])">
                <img class="p-icon" src="usine.png" alt="" loading="lazy" data-fallback="usine.png">
                INCENDIE - POI
              </div>

              <div class="puzzle-piece p-lightgray" onclick="openDriveModal('‚ö†Ô∏è', 'INCIDENT')">
                <img class="p-icon" src="cible.png" alt="" loading="lazy" data-fallback="cible.png">
                INCIDENT
              </div>

              <div class="puzzle-piece p-darkred" onclick="nav('fds', document.querySelectorAll('.nav-link')[3])">
                <img class="p-icon" src="liste.png" alt="" loading="lazy" data-fallback="liste.png">
                FICHE DE SECURITE
              </div>

              <div class="puzzle-piece p-green" onclick="openDriveModal('üìÑ', 'INCIDENT DOCUMENTAIRE')">
                <img class="p-icon" src="liste.png" alt="" loading="lazy" data-fallback="liste.png">
                INCIDENT<br>DOCUMENTAIRE
              </div>
            </div>
          </div>
        </div>

        <!-- PAGE POI -->
        <div id="poi" class="page">
          <div class="puzzle-wrapper">
            <div class="puzzle-header">
              <span class="emoji">üî•</span>
              <h1>ORGANISATION INCENDIE</h1>
            </div>
            <div class="doc-grid">
              <div class="doc-item" onclick="openDriveModal('üî•','POI - DOCUMENTS')">
                <h4>Ouvrir les documents POI</h4>
                <p>Acc√®s √† la base Drive (recherche + aper√ßu int√©gr√©)</p>
              </div>
            </div>
          </div>
        </div>

        <!-- PAGE RETRAIT -->
        <div id="retrait" class="page">
          <div class="puzzle-wrapper">
            <div class="puzzle-header">
              <span class="emoji">‚ö†Ô∏è</span>
              <h1>RETRAIT QUALITE</h1>
            </div>
            <div class="doc-grid">
              <div class="doc-item" onclick="openDriveModal('‚ö†Ô∏è','RETRAIT - DOCUMENTS')">
                <h4>Ouvrir les documents Retrait</h4>
                <p>Acc√®s √† la base Drive (recherche + aper√ßu int√©gr√©)</p>
              </div>
            </div>
          </div>
        </div>

        <!-- PAGE FDS -->
        <div id="fds" class="page">
          <div class="puzzle-wrapper">
            <div class="puzzle-header">
              <span class="emoji">üß™</span>
              <h1>FICHE DE SECURITE</h1>
            </div>
            <div class="doc-grid">
              <div class="doc-item" onclick="openDriveModal('üß™','FDS - DOCUMENTS')">
                <h4>Ouvrir les documents FDS</h4>
                <p>Acc√®s √† la base Drive (recherche + aper√ßu int√©gr√©)</p>
              </div>
            </div>
          </div>
        </div>

        <!-- PAGE REGLEMENTATION -->
        <div id="reglementation" class="page">
          <div class="puzzle-wrapper">
            <div class="puzzle-header">
              <span class="emoji">‚öñÔ∏è</span>
              <h1>REGLEMENTATION</h1>
            </div>
            <div class="doc-grid">
              <div class="doc-item" onclick="openDriveModal('‚öñÔ∏è','REGLEMENTATION - DOCUMENTS')">
                <h4>Ouvrir les documents R√©glementation</h4>
                <p>Acc√®s √† la base Drive (recherche + aper√ßu int√©gr√©)</p>
              </div>
            </div>
          </div>
        </div>

      </div>
    </main>
  </div>

  <!-- MODAL DRIVE VIEWER -->
  <div id="modal" class="modal" onclick="if(event.target === this) closeModal()">
    <div class="modal-content">
      <div class="modal-header">
        <span class="emoji" id="modalEmoji">üìã</span>
        <h2 id="modalTitle">DOCUMENTS</h2>

        <div class="modal-actions">
          <button class="modal-btn" id="btnOpenNew" onclick="openCurrentInNewTab()">Ouvrir</button>
          <button class="modal-btn" onclick="closeModal()">Fermer</button>
        </div>
      </div>

      <div class="modal-body">
        <div class="modal-left">
          <input id="searchInput" class="search" type="text" placeholder="Rechercher un document..." oninput="renderDocList()">
          <div class="doc-list" id="docList"></div>
        </div>

        <div class="modal-right">
          <div class="viewer-bar">
            <div class="viewer-title" id="viewerTitle">S√©lectionne un document √† gauche</div>
          </div>
          <div class="viewer-frame">
            <iframe id="viewerFrame" src=""></iframe>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- TOAST -->
  <div class="toast" id="toast"></div>

  <script>
    /* ==========================
       1) COLLE ICI TOUS TES LIENS
       ========================== */
    const RAW_LINKS = `
https://drive.google.com/open?id=1hEzOUg9OR24DBdY2eAvBJ1Pa8aNH68GD&usp=drive_copy
https://drive.google.com/open?id=1rJaLWE7t4vdD1DY87kuGyhWtP5yf8E1d&usp=drive_copy
https://drive.google.com/open?id=1eYQ79fzfVy1izWmBIKpIxtNRJSU0bCiq&usp=drive_copy
https://drive.google.com/open?id=1BWzJZ8Cmk0GMKVWwA6WRuqAs7927xjxj&usp=drive_copy
https://drive.google.com/open?id=1HIAzCX1hPTtTc9B9T0FQvfRi7pzuLSKY&usp=drive_copy
    `.trim();
    // ‚¨ÜÔ∏è Remplace ce bloc par TOUS tes liens (tu peux coller 300 lignes)

    /* ==========================
       UTILITAIRES DRIVE
       ========================== */
    function extractDriveId(url) {
      if (!url) return null;
      // open?id=XXXX
      const m1 = url.match(/[?&]id=([^&]+)/);
      if (m1 && m1[1]) return m1[1].trim();

      // file/d/XXXX/
      const m2 = url.match(/\/file\/d\/([^\/]+)/);
      if (m2 && m2[1]) return m2[1].trim();

      return null;
    }

    function buildDriveUrls(fileId) {
      return {
        preview: `https://drive.google.com/file/d/${fileId}/preview`,
        view:   `https://drive.google.com/file/d/${fileId}/view?usp=drive_link`
      };
    }

    function parseRawLinks(raw) {
      const lines = raw.split(/\r?\n/).map(s => s.trim()).filter(Boolean);
      const out = [];
      const seen = new Set();

      for (const url of lines) {
        const id = extractDriveId(url);
        if (!id) continue;
        if (seen.has(id)) continue;
        seen.add(id);

        const u = buildDriveUrls(id);
        out.push({
          id,
          title: `Document ${out.length + 1}`,
          viewUrl: u.view,
          previewUrl: u.preview
        });
      }
      return out;
    }

    const DRIVE_DOCS = parseRawLinks(RAW_LINKS);

    /* ==========================
       UI / NAV / LOAD
       ========================== */
    function applyImageFallback(img) {
      const fallback = img.getAttribute('data-fallback') || "241111_Symbole R&B_320x320_RVB.png";
      if (!img.dataset.fallbackApplied) {
        img.dataset.fallbackApplied = "1";
        img.src = fallback;
      }
    }

    window.addEventListener('load', function () {
      setTimeout(() => {
        document.getElementById('loading').classList.add('hidden');
        document.getElementById('app').classList.add('loaded');
      }, 650);
    });

    function nav(id, el) {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      const target = document.getElementById(id);
      if (target) target.classList.add('active');

      const titles = {
        'puzzle': 'Puzzle QHSE',
        'poi': 'Incendie / POI',
        'retrait': 'Retrait Qualit√©',
        'fds': 'Fiches S√©curit√©',
        'reglementation': 'R√©glementation'
      };
      document.getElementById('title-display').textContent = titles[id] || id.toUpperCase();

      document.querySelectorAll('.nav-link').forEach(n => n.classList.remove('active'));
      if (el && el.classList.contains('nav-link')) el.classList.add('active');

      document.querySelector('.scroll-area').scrollTo({ top: 0, behavior: 'smooth' });
    }

    /* ==========================
       MODAL DRIVE VIEWER
       ========================== */
    let CURRENT_DOC = null;

    function openDriveModal(emoji, title) {
      document.getElementById('modalEmoji').textContent = emoji;
      document.getElementById('modalTitle').textContent = title;

      // reset
      document.getElementById('searchInput').value = '';
      CURRENT_DOC = null;
      document.getElementById('viewerTitle').textContent = 'S√©lectionne un document √† gauche';
      document.getElementById('viewerFrame').src = '';
      document.getElementById('btnOpenNew').disabled = true;

      renderDocList();

      document.getElementById('modal').classList.add('active');
      document.body.style.overflow = 'hidden';

      if (DRIVE_DOCS.length === 0) {
        showToast("‚ö†Ô∏è Aucun lien Drive d√©tect√©. V√©rifie RAW_LINKS.");
      } else {
        showToast(`‚úÖ ${DRIVE_DOCS.length} documents charg√©s`);
      }
    }

    function closeModal() {
      document.getElementById('modal').classList.remove('active');
      document.body.style.overflow = '';
      // stop iframe (√©vite audio/chargement)
      document.getElementById('viewerFrame').src = '';
    }

    function renderDocList() {
      const q = (document.getElementById('searchInput').value || '').toLowerCase();
      const list = document.getElementById('docList');

      const filtered = DRIVE_DOCS.filter(d => d.title.toLowerCase().includes(q) || d.id.toLowerCase().includes(q));

      list.innerHTML = filtered.map(d => `
        <div class="doc-row" onclick="selectDoc('${d.id}')">
          <strong>${escapeHtml(d.title)}</strong>
          <small>${d.id}</small>
        </div>
      `).join('');

      if (filtered.length === 0) {
        list.innerHTML = `<div style="color:#aaa;padding:10px;">Aucun r√©sultat.</div>`;
      }
    }

    function selectDoc(id) {
      const doc = DRIVE_DOCS.find(d => d.id === id);
      if (!doc) return;

      CURRENT_DOC = doc;

      document.getElementById('viewerTitle').textContent = doc.title;
      document.getElementById('viewerFrame').src = doc.previewUrl;

      document.getElementById('btnOpenNew').disabled = false;
      showToast(`üìÑ ${doc.title} charg√©`);
    }

    function openCurrentInNewTab() {
      if (!CURRENT_DOC) return;
      window.open(CURRENT_DOC.viewUrl, '_blank', 'noopener,noreferrer');
    }

    /* ==========================
       TOAST
       ========================== */
    function showToast(message) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.add('show');
      clearTimeout(window.__toastTimer);
      window.__toastTimer = setTimeout(() => toast.classList.remove('show'), 2800);
    }

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') closeModal();
    });

    /* ==========================
       IMAGES FALLBACK
       ========================== */
    document.querySelectorAll('img').forEach(img => {
      img.addEventListener('error', function () {
        console.warn('Image non trouv√©e:', this.getAttribute('src'));
        applyImageFallback(this);
      });
    });

    /* ==========================
       SAFE HTML
       ========================== */
    function escapeHtml(str) {
      return String(str)
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }

    /* ==========================
       AUTO: si tu veux renommer
       ========================== */
    // Option : si tu as un fichier "noms" plus tard, on pourra associer id -> nom r√©el.
  </script>
</body>
</html>
