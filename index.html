<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Les Mousquetaires - Portail QHSE Brignoles</title>

  <!-- SEO & Meta -->
  <meta name="description" content="Portail QHSE Les Mousquetaires - Base logistique de Brignoles" />
  <meta name="theme-color" content="#E2001A" />
  <link rel="icon" type="image/png" href="241111_Symbole R&B_320x320_RVB.png" />
  <link rel="apple-touch-icon" href="241111_Symbole R&B_320x320_RVB.png" />

  <!-- Fonts optimis√©s -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700;900&family=Outfit:wght@300;400;600;700;900&display=swap" rel="stylesheet" />

  <style>
    :root {
      --primary: #E2001A;
      --primary-dark: #b00015;
      --primary-glow: rgba(226, 0, 26, 0.6);
      --bg-deep: #020203;
      --bg-darker: #000000;
      --border: rgba(255, 255, 255, 0.12);
      --border-light: rgba(255, 255, 255, 0.08);
      --text-main: #ffffff;
      --text-dim: #a8a8a8;
      --text-muted: #707070;

      --sidebar-width: 300px;
      --header-height: 90px;
      --radius: 16px;
      --radius-lg: 20px;
      --transition: 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
      --transition-smooth: 0.3s ease;

      --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.15);
      --shadow-md: 0 8px 30px rgba(0, 0, 0, 0.25);
      --shadow-lg: 0 20px 60px rgba(0, 0, 0, 0.4);
      --shadow-xl: 0 40px 100px rgba(0, 0, 0, 0.6);
    }

    /* RESET & BASE */
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

    html {
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      text-rendering: optimizeLegibility;
    }

    body {
      font-family: 'Outfit', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background-color: var(--bg-deep);
      color: var(--text-main);
      overflow: hidden;
      height: 100vh;
      width: 100vw;
      position: relative;
      line-height: 1.6;
    }

    ::selection { background: var(--primary); color: white; }

    /* FOND OPTIMIS√â */
    body::before {
      content: "";
      position: fixed;
      inset: 0;
      background: url("PPT Couverture_D3.jpg") center/cover no-repeat;
      opacity: 0.22;
      filter: saturate(0.92) contrast(1.08) brightness(0.95);
      z-index: -5;
      pointer-events: none;
      will-change: transform;
      animation: subtleZoom 35s ease-in-out infinite alternate;
    }

    @keyframes subtleZoom {
      0% { transform: scale(1) translateX(0); }
      100% { transform: scale(1.08) translateX(-20px); }
    }

    body::after {
      content: "";
      position: fixed;
      inset: 0;
      background:
        radial-gradient(ellipse 800px 600px at 25% 15%, rgba(226, 0, 26, 0.08), transparent 60%),
        radial-gradient(ellipse 600px 800px at 75% 85%, rgba(0, 0, 0, 0.75), transparent 60%),
        linear-gradient(180deg, rgba(0,0,0,0.72), rgba(0,0,0,0.94));
      z-index: -4;
      pointer-events: none;
    }

    /* GRID */
    #bg-grid {
      position: fixed;
      inset: 0;
      background-image:
        repeating-linear-gradient(0deg, rgba(255, 255, 255, 0.03) 0px, transparent 1px, transparent 60px),
        repeating-linear-gradient(90deg, rgba(255, 255, 255, 0.03) 0px, transparent 1px, transparent 60px);
      transform: perspective(700px) rotateX(60deg) translateY(-150px) translateZ(-250px);
      animation: gridFlow 30s linear infinite;
      z-index: -3;
      pointer-events: none;
      opacity: 0.5;
    }

    @keyframes gridFlow {
      0% { transform: perspective(700px) rotateX(60deg) translateY(0) translateZ(-250px); }
      100% { transform: perspective(700px) rotateX(60deg) translateY(60px) translateZ(-250px); }
    }

    /* LOADING */
    .loading-overlay {
      position: fixed;
      inset: 0;
      background: var(--bg-deep);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10000;
      opacity: 1;
      transition: opacity 0.5s ease;
    }
    .loading-overlay.hidden { opacity: 0; pointer-events: none; }
    .spinner {
      width: 60px;
      height: 60px;
      border: 4px solid rgba(255, 255, 255, 0.1);
      border-top-color: var(--primary);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* LAYOUT */
    .app {
      display: flex;
      height: 100vh;
      width: 100%;
      opacity: 0;
      transition: opacity 0.6s ease;
    }
    .app.loaded { opacity: 1; }

    /* SIDEBAR */
    .sidebar {
      width: var(--sidebar-width);
      background: linear-gradient(180deg, rgba(10, 10, 15, 0.97), rgba(5, 5, 10, 0.99));
      border-right: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      z-index: 100;
      backdrop-filter: blur(25px) saturate(150%);
      box-shadow: 8px 0 50px rgba(0, 0, 0, 0.5);
      position: relative;
    }

    .sidebar::before {
      content: '';
      position: absolute;
      top: 0;
      right: 0;
      width: 1px;
      height: 100%;
      background: linear-gradient(180deg, transparent, var(--primary) 40%, var(--primary) 60%, transparent);
      opacity: 0.25;
    }

    .brand-box {
      padding: 30px 26px;
      display: flex;
      align-items: center;
      gap: 18px;
      border-bottom: 1px solid var(--border);
      background: rgba(0, 0, 0, 0.35);
      position: relative;
    }

    .brand-box::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 26px;
      right: 26px;
      height: 2px;
      background: linear-gradient(90deg, var(--primary), transparent 70%);
    }

    .brand-logo {
      width: 64px;
      height: 64px;
      object-fit: contain;
      border-radius: 16px;
      filter: drop-shadow(0 10px 25px rgba(226, 0, 26, 0.5));
      transition: var(--transition);
      cursor: pointer;
    }
    .brand-logo:hover {
      transform: scale(1.12) rotate(-8deg);
      filter: drop-shadow(0 15px 35px rgba(226, 0, 26, 0.7));
    }

    .brand-text { flex: 1; }
    .brand-text h2 {
      font-family: 'Rajdhani', sans-serif;
      font-weight: 900;
      font-size: 22px;
      line-height: 1;
      letter-spacing: 1.2px;
      text-transform: uppercase;
      background: linear-gradient(135deg, #fff 0%, #e0e0e0 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .brand-text span {
      font-size: 11px;
      color: var(--text-dim);
      display: block;
      margin-top: 7px;
      letter-spacing: 0.8px;
      font-weight: 500;
    }

    .menu { flex: 1; overflow-y: auto; padding: 26px 20px; }
    .menu::-webkit-scrollbar { width: 5px; }
    .menu::-webkit-scrollbar-track { background: transparent; }
    .menu::-webkit-scrollbar-thumb {
      background: linear-gradient(180deg, var(--primary), var(--primary-dark));
      border-radius: 3px;
    }

    .nav-link {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 18px 20px;
      color: var(--text-dim);
      border-radius: 15px;
      margin-bottom: 12px;
      transition: var(--transition);
      border: 1px solid transparent;
      font-family: 'Rajdhani', sans-serif;
      font-size: 17px;
      font-weight: 700;
      cursor: pointer;
      position: relative;
      overflow: hidden;
      user-select: none;
    }

    .nav-link::before {
      content: '';
      position: absolute;
      left: -100%;
      top: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(226, 0, 26, 0.18), transparent);
      transition: left 0.7s ease;
    }
    .nav-link:hover::before { left: 100%; }

    .nav-link:hover {
      background: rgba(255,255,255,0.09);
      color: #fff;
      border-color: rgba(255, 255, 255, 0.15);
      transform: translateX(8px);
    }

    .nav-link.active {
      background: linear-gradient(135deg, rgba(226,0,26,0.28), rgba(226,0,26,0.12));
      border-left: 4px solid var(--primary);
      color: white;
      text-shadow: 0 0 20px rgba(226, 0, 26, 0.8);
      box-shadow: 0 6px 25px rgba(226, 0, 26, 0.35);
      transform: translateX(8px);
    }

    .nav-icon {
      width: 30px;
      height: 30px;
      object-fit: contain;
      filter: drop-shadow(0 4px 8px rgba(0,0,0,0.5));
      flex-shrink: 0;
      transition: var(--transition);
    }

    .nav-link:hover .nav-icon,
    .nav-link.active .nav-icon {
      transform: scale(1.15) rotate(3deg);
      filter: drop-shadow(0 6px 12px rgba(226, 0, 26, 0.6));
    }

    /* MAIN */
    .main-content { flex: 1; display: flex; flex-direction: column; position: relative; overflow: hidden; }

    /* TOPBAR */
    .topbar {
      height: var(--header-height);
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 50px;
      border-bottom: 1px solid var(--border);
      background: linear-gradient(180deg, rgba(10, 10, 15, 0.96), rgba(10, 10, 15, 0.92));
      backdrop-filter: blur(25px) saturate(150%);
      box-shadow: 0 6px 35px rgba(0, 0, 0, 0.35);
      position: sticky;
      top: 0;
      z-index: 90;
    }

    .topbar::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, var(--primary) 50%, transparent);
      opacity: 0.4;
    }

    .page-title { display: flex; align-items: center; gap: 18px; }

    .topbar-logo {
      width: 42px;
      height: 42px;
      object-fit: contain;
      filter: drop-shadow(0 8px 20px rgba(226, 0, 26, 0.6));
      will-change: transform;
      animation: floatLogo 3.5s ease-in-out infinite;
    }

    @keyframes floatLogo {
      0%, 100% { transform: translateY(0) rotate(0deg); }
      50% { transform: translateY(-6px) rotate(-3deg); }
    }

    .page-title h2 {
      font-size: 32px;
      font-weight: 900;
      color: white;
      font-family: 'Rajdhani', sans-serif;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      text-shadow: 0 3px 15px rgba(0, 0, 0, 0.6);
      background: linear-gradient(135deg, #fff 0%, #d8d8d8 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .actions { display: flex; gap: 16px; align-items: center; }

    .btn-icon {
      width: 52px;
      height: 52px;
      border-radius: 16px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.06);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: var(--transition);
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }

    .btn-icon::before {
      content: '';
      position: absolute;
      inset: 0;
      background: radial-gradient(circle, var(--primary), transparent 70%);
      opacity: 0;
      transition: opacity 0.4s ease;
    }
    .btn-icon:hover::before { opacity: 0.35; }

    .btn-icon:hover {
      background: var(--primary);
      box-shadow: 0 8px 30px var(--primary-glow);
      transform: translateY(-4px);
      border-color: var(--primary);
    }

    .btn-icon img {
      width: 26px;
      height: 26px;
      object-fit: contain;
      filter: drop-shadow(0 3px 6px rgba(0,0,0,0.5));
      transition: var(--transition);
    }
    .btn-icon:hover img { transform: scale(1.2); }

    /* SCROLL */
    .scroll-area {
      flex: 1;
      overflow-y: auto;
      overflow-x: hidden;
      padding: 55px;
      scroll-behavior: smooth;
    }

    .scroll-area::-webkit-scrollbar { width: 10px; }
    .scroll-area::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.04);
      border-radius: 5px;
      margin: 10px;
    }
    .scroll-area::-webkit-scrollbar-thumb {
      background: linear-gradient(180deg, var(--primary), var(--primary-dark));
      border-radius: 5px;
      border: 2px solid transparent;
      background-clip: padding-box;
    }

    .page { display: none; }
    .page.active { display: block; animation: pageEntrance 0.7s cubic-bezier(0.34, 1.56, 0.64, 1); }

    @keyframes pageEntrance {
      from { opacity: 0; transform: translateY(50px) scale(0.96); }
      to { opacity: 1; transform: translateY(0) scale(1); }
    }

    /* PUZZLE */
    .puzzle-wrapper {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: calc(100vh - 250px);
      padding: 30px;
    }

    .puzzle-header { text-align: center; margin-bottom: 55px; animation: fadeInDown 0.9s ease; }

    @keyframes fadeInDown {
      from { opacity: 0; transform: translateY(-40px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .puzzle-header h1 {
      font-size: 58px;
      font-weight: 900;
      background: linear-gradient(135deg, #fff 0%, var(--primary) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 15px;
      text-shadow: 0 0 40px var(--primary-glow);
      letter-spacing: 2.5px;
      font-family: 'Rajdhani', sans-serif;
    }

    .puzzle-header .emoji {
      font-size: 75px;
      display: block;
      margin-bottom: 18px;
      filter: drop-shadow(0 10px 30px rgba(226, 0, 26, 0.4));
      will-change: transform;
      animation: emojiFloat 3.8s ease-in-out infinite;
    }

    @keyframes emojiFloat {
      0%, 100% { transform: translateY(0) rotate(0deg) scale(1); }
      25% { transform: translateY(-8px) rotate(4deg) scale(1.05); }
      75% { transform: translateY(-12px) rotate(-4deg) scale(1.05); }
    }

    .puzzle-container {
      position: relative;
      max-width: 1150px;
      width: 100%;
      aspect-ratio: 5/4;
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      grid-template-rows: repeat(4, 1fr);
      gap: 0;
      border-radius: 18px;
      overflow: hidden;
      box-shadow:
        0 35px 90px rgba(0, 0, 0, 0.65),
        0 0 0 1px rgba(255, 255, 255, 0.06),
        inset 0 0 0 1px rgba(255, 255, 255, 0.03);
      animation: puzzleEntrance 1.1s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    @keyframes puzzleEntrance {
      from { opacity: 0; transform: scale(0.88) rotateX(12deg) rotateY(-5deg); }
      to { opacity: 1; transform: scale(1) rotateX(0deg) rotateY(0deg); }
    }

    .puzzle-piece {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 14px;
      font-family: 'Rajdhani', sans-serif;
      font-weight: 900;
      font-size: clamp(11px, 1.35vw, 18px);
      text-transform: uppercase;
      letter-spacing: 0.7px;
      line-height: 1.2;
      color: white;
      text-shadow: 0 4px 10px rgba(0, 0, 0, 0.6);
      cursor: pointer;
      transition: all 0.45s cubic-bezier(0.34, 1.56, 0.64, 1);
      border: 1px solid rgba(0, 0, 0, 0.12);
      position: relative;
      overflow: hidden;
      user-select: none;
    }

    .p-icon {
      width: 34px;
      height: 34px;
      object-fit: contain;
      margin-bottom: 12px;
      filter: drop-shadow(0 4px 10px rgba(0,0,0,0.6));
      transition: var(--transition);
    }

    /* COULEURS */
    .p-red { background: linear-gradient(135deg, #e10600 0%, #b00015 100%); }
    .p-cyan { background: linear-gradient(135deg, #20c997 0%, #17a07a 100%); }
    .p-orange { background: linear-gradient(135deg, #ffb02e 0%, #e09500 100%); }
    .p-gray { background: linear-gradient(135deg, #5c5c5c 0%, #3a3a3a 100%); }
    .p-teal { background: linear-gradient(135deg, #0f6a5a 0%, #094538 100%); }
    .p-blue { background: linear-gradient(135deg, #1f4bff 0%, #1235cc 100%); }
    .p-yellow { background: linear-gradient(135deg, #f7f17a 0%, #e0d050 100%); color: #1a1a1a; }
    .p-magenta { background: linear-gradient(135deg, #b800ff 0%, #8e00cc 100%); }
    .p-lime { background: linear-gradient(135deg, #8bd84c 0%, #68b02e 100%); }
    .p-purple { background: linear-gradient(135deg, #6a7cff 0%, #4a5acc 100%); }
    .p-pink { background: linear-gradient(135deg, #ff3bb2 0%, #cc2888 100%); }
    .p-aqua { background: linear-gradient(135deg, #00d0ff 0%, #00a3cc 100%); }
    .p-lightyellow { background: linear-gradient(135deg, #f3e401 0%, #c4b500 100%); color: #1a1a1a; }
    .p-darkpurple { background: linear-gradient(135deg, #582f93 0%, #3a1f63 100%); }
    .p-lightpurple { background: linear-gradient(135deg, #8a9cff 0%, #6875cc 100%); }
    .p-wine { background: linear-gradient(135deg, #7a0026 0%, #55001a 100%); }
    .p-lightgray { background: linear-gradient(135deg, #dfe3ff 0%, #bac0dd 100%); color: #1a1a1a; }
    .p-darkred { background: linear-gradient(135deg, #e10600 0%, #980400 100%); }
    .p-green { background: linear-gradient(135deg, #00b894 0%, #008f6f 100%); }

    /* MODAL */
    .modal {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.90);
      backdrop-filter: blur(15px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 30px;
    }
    .modal.active { display: flex; }

    .modal-content {
      background: linear-gradient(180deg, rgba(20, 20, 25, 0.99), rgba(12, 12, 17, 0.99));
      border: 1px solid var(--border);
      border-radius: 26px;
      max-width: 980px;
      width: 100%;
      max-height: 92vh;
      overflow-y: auto;
      box-shadow: 0 50px 120px rgba(0, 0, 0, 0.95);
    }

    .modal-header {
      padding: 38px;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      gap: 20px;
      background: rgba(0, 0, 0, 0.4);
    }

    .modal-header .emoji { font-size: 52px; }
    .modal-header h2 {
      font-size: 38px;
      font-weight: 900;
      font-family: 'Rajdhani', sans-serif;
      text-transform: uppercase;
      color: white;
      letter-spacing: 1.5px;
    }

    .modal-close {
      margin-left: auto;
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid var(--border);
      color: white;
      padding: 14px 28px;
      border-radius: 14px;
      cursor: pointer;
      font-weight: 800;
      font-family: 'Rajdhani', sans-serif;
      text-transform: uppercase;
      font-size: 15px;
      letter-spacing: 0.8px;
    }
    .modal-body { padding: 38px; }

    .doc-grid { display: grid; gap: 20px; }
    .doc-item {
      background: rgba(255, 255, 255, 0.045);
      border: 1px solid var(--border-light);
      border-radius: 16px;
      padding: 26px;
    }
    .doc-item h4 {
      font-size: 20px;
      font-weight: 900;
      color: white;
      margin-bottom: 8px;
      text-transform: uppercase;
      font-family: 'Rajdhani', sans-serif;
    }
    .doc-item p { font-size: 14px; color: var(--text-dim); }

    /* TOAST */
    .toast {
      position: fixed;
      bottom: 30px;
      right: 30px;
      background: linear-gradient(135deg, rgba(226, 0, 26, 0.95), rgba(176, 0, 21, 0.95));
      color: white;
      padding: 18px 26px;
      border-radius: 14px;
      box-shadow: 0 10px 40px rgba(226, 0, 26, 0.5);
      z-index: 10001;
      opacity: 0;
      transform: translateY(20px);
      transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
      pointer-events: none;
      font-family: 'Rajdhani', sans-serif;
      font-weight: 700;
      font-size: 16px;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    .toast.show { opacity: 1; transform: translateY(0); }

    /* MOBILE */
    @media (max-width: 1024px) {
      :root { --sidebar-width: 100%; --header-height: 70px; }
      .app { flex-direction: column; }
      .sidebar {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 80px;
        flex-direction: row;
        align-items: center;
        padding: 0;
        border-top: 2px solid var(--primary);
        border-right: none;
        justify-content: space-around;
        overflow: visible;
        background: rgba(5,5,5,0.99);
        box-shadow: 0 -10px 40px rgba(226,0,26,0.5);
        z-index: 1001;
      }
      .sidebar::before { display: none; }
      .brand-box { display: none; }
      .menu { display: flex; flex-direction: row; padding: 0; width: 100%; justify-content: space-around; align-items: center; gap: 4px; }
      .nav-link { flex-direction: column; gap: 7px; font-size: 11px; padding: 12px 6px; border: none; margin: 0; background: transparent !important; width: 78px; justify-content: center; border-radius: 0; }
      .nav-link::before { display: none; }
      .nav-link:hover { transform: translateY(-8px); background: rgba(255,255,255,0.05) !important; }
      .nav-link.active { color: var(--primary); text-shadow: 0 0 25px var(--primary); transform: translateY(-10px) scale(1.05); border-left: none; background: rgba(226, 0, 26, 0.15) !important; }
      .nav-icon { width: 28px; height: 28px; margin-bottom: 0; }
      .main-content { margin-bottom: 80px; height: calc(100vh - 80px); }
      .topbar { padding: 0 22px; height: var(--header-height); }
      .page-title h2 { font-size: 21px; }
      .topbar-logo { width: 34px; height: 34px; }
      .scroll-area { padding: 28px; }
      .puzzle-container { grid-template-columns: repeat(3, 1fr); grid-template-rows: auto; aspect-ratio: auto; }
      .puzzle-header h1 { font-size: 36px; }
      .puzzle-header .emoji { font-size: 55px; }
      .modal { padding: 20px; }
      .modal-header { padding: 28px; }
      .modal-header h2 { font-size: 26px; }
      .modal-header .emoji { font-size: 40px; }
      .modal-body { padding: 28px; }
      .btn-icon { width: 46px; height: 46px; }
      .btn-icon img { width: 22px; height: 22px; }
      .toast { bottom: 100px; right: 20px; left: 20px; text-align: center; }
    }
  </style>
</head>

<body>
  <!-- LOADING OVERLAY -->
  <div class="loading-overlay" id="loading">
    <div class="spinner"></div>
  </div>

  <div id="bg-grid"></div>

  <div class="app" id="app">
    <!-- SIDEBAR -->
    <nav class="sidebar">
      <div class="brand-box">
        <img class="brand-logo"
             src="GROUPEMENT_MOUSQUETAIRES_H_INV_HD.png"
             alt="Groupement Mousquetaires"
             onclick="nav('puzzle', document.querySelectorAll('.nav-link')[0])"
             data-fallback="241111_Symbole R&B_320x320_RVB.png">

        <div class="brand-text">
          <h2>BRIGNOLES</h2>
          <span>LOGISTIQUE &amp; QHSE</span>
        </div>
      </div>

      <div class="menu">
        <div class="nav-link active" onclick="nav('puzzle', this)">
          <img class="nav-icon" src="liste.png" alt="Puzzle" loading="lazy" data-fallback="liste.png">
          <span>Puzzle QHSE</span>
        </div>
        <div class="nav-link" onclick="nav('poi', this)">
          <img class="nav-icon" src="usine.png" alt="Incendie" loading="lazy" data-fallback="usine.png">
          <span>Incendie</span>
        </div>

        <div class="nav-link" onclick="nav('retrait', this)">
          <img class="nav-icon" src="chariot.png" alt="Retrait" loading="lazy" data-fallback="carton.png">
          <span>Retrait</span>
        </div>

        <div class="nav-link" onclick="nav('fds', this)">
          <img class="nav-icon" src="cible.png" alt="FDS" loading="lazy" data-fallback="cible.png">
          <span>FDS</span>
        </div>

        <div class="nav-link" onclick="nav('reglementation', this)">
          <img class="nav-icon" src="liste.png" alt="R√®glement" loading="lazy" data-fallback="liste.png">
          <span>R√®glement</span>
        </div>
      </div>
    </nav>

    <!-- MAIN -->
    <main class="main-content">
      <header class="topbar">
        <div class="page-title">
          <img class="topbar-logo" src="241111_Symbole R&B_320x320_RVB.png" alt="Logo" loading="lazy" data-fallback="241111_Symbole R&B_320x320_RVB.png">
          <h2 id="title-display">Puzzle QHSE</h2>
        </div>

        <div class="actions">
          <div class="btn-icon" title="Retour √† l'accueil" onclick="nav('puzzle', document.querySelectorAll('.nav-link')[0])">
            <img src="maison.png" alt="Accueil" loading="lazy" data-fallback="maison.png">
          </div>
        </div>
      </header>

      <div class="scroll-area">

        <!-- PAGE PUZZLE -->
        <div id="puzzle" class="page active">
          <div class="puzzle-wrapper">
            <div class="puzzle-header">
              <span class="emoji">üß©</span>
              <h1>ACCUEIL</h1>
            </div>

            <div class="puzzle-container">
              <div class="puzzle-piece p-red" onclick="openModal('procedures', 'üìã', 'PROCEDURES')">
                <img class="p-icon" src="liste.png" alt="" loading="lazy" data-fallback="liste.png">
                PROCEDURES
              </div>

              <div class="puzzle-piece p-cyan" onclick="openModal('evaluation', 'üìä', 'EVALUATION')">
                <img class="p-icon" src="cible.png" alt="" loading="lazy" data-fallback="cible.png">
                EVALUATION
              </div>

              <div class="puzzle-piece p-orange" onclick="openModal('referentiels', 'üìö', 'REFERENTIELS')">
                <img class="p-icon" src="liste.png" alt="" loading="lazy" data-fallback="liste.png">
                REFERENTIELS
              </div>

              <div class="puzzle-piece p-gray" onclick="openModal('personnel', 'üë•', 'LISTE PERSONNEL')">
                <img class="p-icon" src="mains.png" alt="" loading="lazy" data-fallback="mains.png">
                LISTE PERSONNEL<br>AFFICHAGE
              </div>

              <div class="puzzle-piece p-teal" onclick="openModal('dechets', '‚ôªÔ∏è', 'SUIVI DES DECHETS')">
                <img class="p-icon" src="camion.png" alt="" loading="lazy" data-fallback="camion.png">
                SUIVI DES DECHETS
              </div>

              <div class="puzzle-piece p-blue" onclick="openModal('indicateurs', 'üìà', 'INDICATEURS')">
                <img class="p-icon" src="ville.png" alt="" loading="lazy" data-fallback="ville.png">
                INDICATEURS
              </div>

              <div class="puzzle-piece p-yellow" onclick="openModal('affichage', 'üì∫', 'AFFICHAGE')">
                <img class="p-icon" src="magasin.png" alt="" loading="lazy" data-fallback="magasin.png">
                AFFICHAGE
              </div>

              <div class="puzzle-piece p-magenta" onclick="openModal('formation', 'üéì', 'FORMATION')">
                <img class="p-icon" src="conseiller.png" alt="" loading="lazy" data-fallback="conseiller.png">
                FORMATION
              </div>

              <div class="puzzle-piece p-lime" onclick="openModal('suiviat', 'üè•', 'SUIVI DES AT')">
                <img class="p-icon" src="ouvrier.png" alt="" loading="lazy" data-fallback="ouvrier.png">
                SUIVI DES AT
              </div>

              <div class="puzzle-piece p-purple" onclick="openModal('reglementation', '‚öñÔ∏è', 'REGLEMENTATION')">
                <img class="p-icon" src="liste.png" alt="" loading="lazy" data-fallback="liste.png">
                REGLEMENTATION
              </div>

              <div class="puzzle-piece p-pink" onclick="openModal('coordonnees', 'üó∫Ô∏è', 'COORDONNEES & PLAN')">
                <img class="p-icon" src="localisation.png" alt="" loading="lazy" data-fallback="localisation.png">
                COORDONNEES &<br>PLAN
              </div>

              <div class="puzzle-piece p-aqua" onclick="openModal('rdaudit', 'üîç', 'REVUE DIRECTION & AUDIT')">
                <img class="p-icon" src="cible.png" alt="" loading="lazy" data-fallback="cible.png">
                REVUE DIRECTION<br>& AUDIT
              </div>

              <div class="puzzle-piece p-lightyellow" onclick="openModal('intervention', 'üõ†Ô∏è', 'INTERVENTION')">
                <img class="p-icon" src="transpalette.png" alt="" loading="lazy" data-fallback="transpalette.png">
                INTERVENTION
              </div>

              <div class="puzzle-piece p-darkpurple" onclick="openModal('crreunion', 'üí¨', 'CR REUNION')">
                <img class="p-icon" src="mains.png" alt="" loading="lazy" data-fallback="mains.png">
                CR REUNION
              </div>

              <div class="puzzle-piece p-lightpurple" onclick="openModal('reglementation2', '‚öñÔ∏è', 'REGLEMENTATION')">
                <img class="p-icon" src="liste.png" alt="" loading="lazy" data-fallback="liste.png">
                REGLEMENTATION
              </div>

              <div class="puzzle-piece p-wine" onclick="nav('retrait', document.querySelectorAll('.nav-link')[2])">
                <img class="p-icon" src="chariot.png" alt="" loading="lazy" data-fallback="carton.png">
                RETRAIT<br>QUALITE
              </div>

              <div class="puzzle-piece p-red" onclick="nav('poi', document.querySelectorAll('.nav-link')[1])">
                <img class="p-icon" src="usine.png" alt="" loading="lazy" data-fallback="usine.png">
                INCENDIE - POI
              </div>

              <div class="puzzle-piece p-lightgray" onclick="openModal('incident', '‚ö†Ô∏è', 'INCIDENT')">
                <img class="p-icon" src="cible.png" alt="" loading="lazy" data-fallback="cible.png">
                INCIDENT
              </div>

              <div class="puzzle-piece p-darkred" onclick="nav('fds', document.querySelectorAll('.nav-link')[3])">
                <img class="p-icon" src="liste.png" alt="" loading="lazy" data-fallback="liste.png">
                FICHE DE SECURITE
              </div>

              <div class="puzzle-piece p-green" onclick="openModal('incidentdoc', 'üìÑ', 'INCIDENT DOCUMENTAIRE')">
                <img class="p-icon" src="liste.png" alt="" loading="lazy" data-fallback="liste.png">
                INCIDENT<br>DOCUMENTAIRE
              </div>
            </div>
          </div>
        </div>

        <!-- PAGE POI -->
        <div id="poi" class="page">
          <div class="puzzle-wrapper">
            <div class="puzzle-header">
              <span class="emoji">üî•</span>
              <h1>ORGANISATION INCENDIE</h1>
            </div>
            <div class="doc-grid" style="max-width: 900px; width: 100%;">
              <div class="doc-item" onclick="openModal('poi', 'üî•', 'INCENDIE / POI')">
                <h4>Documents Incendie / POI</h4>
                <p>Ouvre la liste des documents POI (dans la modale)</p>
              </div>
            </div>
          </div>
        </div>

        <!-- PAGE RETRAIT -->
        <div id="retrait" class="page">
          <div class="puzzle-wrapper">
            <div class="puzzle-header">
              <span class="emoji">‚ö†Ô∏è</span>
              <h1>RETRAIT QUALITE</h1>
            </div>
            <div class="doc-grid" style="max-width: 900px; width: 100%;">
              <div class="doc-item" onclick="openModal('retrait', '‚ö†Ô∏è', 'RETRAIT QUALITE')">
                <h4>Documents Retrait Qualit√©</h4>
                <p>Ouvre la liste des documents Retrait (dans la modale)</p>
              </div>
            </div>
          </div>
        </div>

        <!-- PAGE FDS -->
        <div id="fds" class="page">
          <div class="puzzle-wrapper">
            <div class="puzzle-header">
              <span class="emoji">üß™</span>
              <h1>FICHE DE SECURITE</h1>
            </div>
            <div class="doc-grid" style="max-width: 900px; width: 100%;">
              <div class="doc-item" onclick="openModal('fds', 'üß™', 'FICHE DE SECURITE')">
                <h4>Base FDS</h4>
                <p>Ouvre la liste des fiches (dans la modale)</p>
              </div>
            </div>
          </div>
        </div>

        <!-- PAGE REGLEMENTATION -->
        <div id="reglementation" class="page">
          <div class="puzzle-wrapper">
            <div class="puzzle-header">
              <span class="emoji">‚öñÔ∏è</span>
              <h1>REGLEMENTATION</h1>
            </div>
            <div class="doc-grid" style="max-width: 900px; width: 100%;">
              <div class="doc-item" onclick="openModal('reglementation', '‚öñÔ∏è', 'REGLEMENTATION')">
                <h4>Documents R√®glementation</h4>
                <p>Ouvre la liste des documents (dans la modale)</p>
              </div>
            </div>
          </div>
        </div>

      </div>
    </main>
  </div>

  <!-- MODAL -->
  <div id="modal" class="modal" onclick="if(event.target === this) closeModal()">
    <div class="modal-content">
      <div class="modal-header">
        <span class="emoji" id="modalEmoji">üìã</span>
        <h2 id="modalTitle">TITRE</h2>
        <button class="modal-close" onclick="closeModal()">Accueil</button>
      </div>
      <div class="modal-body">
        <div class="doc-grid" id="modalContent"></div>
      </div>
    </div>
  </div>

  <!-- TOAST -->
  <div class="toast" id="toast"></div>

  <script>
    // ‚úÖ Fallback robuste : si image cass√©e -> remplace par data-fallback (ou logo par d√©faut)
    function applyImageFallback(img) {
      const fallback = img.getAttribute('data-fallback') || "241111_Symbole R&B_320x320_RVB.png";
      if (!img.dataset.fallbackApplied) {
        img.dataset.fallbackApplied = "1";
        img.src = fallback;
      }
    }

    // CHARGEMENT
    window.addEventListener('load', function () {
      setTimeout(() => {
        document.getElementById('loading').classList.add('hidden');
        document.getElementById('app').classList.add('loaded');
      }, 800);
    });

    // NAV
    function nav(id, el) {
      document.querySelectorAll('.page').forEach(p => {
        p.style.opacity = '0';
        setTimeout(() => p.classList.remove('active'), 200);
      });

      setTimeout(() => {
        const target = document.getElementById(id);
        if (target) {
          target.classList.add('active');
          setTimeout(() => target.style.opacity = '1', 50);
        }
      }, 250);

      const titles = {
        'puzzle': 'Puzzle QHSE',
        'poi': 'Incendie / POI',
        'retrait': 'Retrait Qualit√©',
        'fds': 'Fiches S√©curit√©',
        'reglementation': 'R√©glementation'
      };
      document.getElementById('title-display').textContent = titles[id] || id.toUpperCase();

      document.querySelectorAll('.nav-link').forEach(n => n.classList.remove('active'));
      if (el && el.classList.contains('nav-link')) el.classList.add('active');

      document.querySelector('.scroll-area').scrollTo({ top: 0, behavior: 'smooth' });
    }

    // ==== DRIVE HELPERS ====
    function extractDriveId(url){
      const m1 = url.match(/[?&]id=([^&]+)/);
      if (m1) return m1[1];
      const m2 = url.match(/\/file\/d\/([^/]+)/);
      if (m2) return m2[1];
      return null;
    }
    function normalizeViewUrl(url){
      const id = extractDriveId(url);
      if (!id) return url;
      return `https://drive.google.com/file/d/${id}/view`;
    }
    function normalizeDownloadUrl(url){
      const id = extractDriveId(url);
      if (!id) return url;
      return `https://drive.google.com/uc?export=download&id=${id}`;
    }

    // ==== DATA (COLLE TES LIENS ICI) ====
    // IMPORTANT : tu peux mettre tout au d√©but dans procedures, puis trier plus tard.
    const DOCS = {
      procedures: [
        // ‚úÖ Exemple (remplace/colle tes liens ici)
        { title: "Document 1", url: "https://drive.google.com/open?id=1hEzOUg9OR24DBdY2eAvBJ1Pa8aNH68GD&usp=drive_copy" },
        { title: "Document 2", url: "https://drive.google.com/open?id=1rJaLWE7t4vdD1DY87kuGyhWtP5yf8E1d&usp=drive_copy" }
      ],
      poi: [],
      retrait: [],
      fds: [],
      reglementation: [],
      evaluation: [],
      referentiels: [],
      personnel: [],
      dechets: [],
      indicateurs: [],
      affichage: [],
      formation: [],
      suiviat: [],
      coordonnees: [],
      rdaudit: [],
      intervention: [],
      crreunion: [],
      incident: [],
      incidentdoc: [],
      reglementation2: []
    };

    // MODAL (avec recherche + compteur + boutons ouvrir/t√©l√©charger)
    function openModal(key, emoji, title) {
      document.getElementById('modalEmoji').textContent = emoji;
      document.getElementById('modalTitle').textContent = title;

      const container = document.getElementById('modalContent');
      const list = (DOCS[key] || []).map((d, idx) => {
        const raw = d.url || "";
        const viewUrl = normalizeViewUrl(raw);
        const dlUrl = normalizeDownloadUrl(raw);
        const id = extractDriveId(raw) || `link-${idx+1}`;
        const safeTitle = (d.title && d.title.trim()) ? d.title.trim() : `${title} - Document ${idx+1}`;

        return { title: safeTitle, id, raw, viewUrl, dlUrl };
      });

      container.innerHTML = `
        <div style="display:flex; gap:12px; align-items:center; margin-bottom:18px; flex-wrap:wrap;">
          <input id="docSearch" type="search" placeholder="Rechercher (titre / id)..."
            style="
              flex:1; min-width:240px;
              padding:12px 14px;
              border-radius:14px;
              border:1px solid rgba(255,255,255,0.12);
              background: rgba(255,255,255,0.06);
              color:#fff;
              outline:none;
            "
          />
          <div id="docCount" style="color: rgba(255,255,255,0.72); font-weight:700; font-family:'Rajdhani',sans-serif;">
            ${list.length} document(s)
          </div>
        </div>
        <div id="docGrid" class="doc-grid"></div>
      `;

      const grid = document.getElementById("docGrid");
      const search = document.getElementById("docSearch");
      const count = document.getElementById("docCount");

      function render(items){
        grid.innerHTML = items.map(item => `
          <div class="doc-item">
            <h4 style="display:flex; align-items:center; justify-content:space-between; gap:10px;">
              <span>${item.title}</span>
              <span style="font-size:12px; color: rgba(255,255,255,0.55); font-weight:700;">${item.id}</span>
            </h4>

            <p style="word-break:break-all; margin-top:8px;">${item.raw}</p>

            <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:14px;">
              <a href="${item.viewUrl}" target="_blank" rel="noopener"
                 style="
                  display:inline-flex; align-items:center; justify-content:center;
                  padding:10px 14px; border-radius:12px;
                  border:1px solid rgba(255,255,255,0.14);
                  background: rgba(255,255,255,0.06);
                  color:#fff; text-decoration:none; font-weight:800;
                  font-family:'Rajdhani',sans-serif; letter-spacing:0.6px;
                 "
              >Ouvrir</a>

              <a href="${item.dlUrl}" target="_blank" rel="noopener"
                 style="
                  display:inline-flex; align-items:center; justify-content:center;
                  padding:10px 14px; border-radius:12px;
                  border:1px solid rgba(226,0,26,0.35);
                  background: rgba(226,0,26,0.16);
                  color:#fff; text-decoration:none; font-weight:800;
                  font-family:'Rajdhani',sans-serif; letter-spacing:0.6px;
                 "
              >T√©l√©charger</a>
            </div>
          </div>
        `).join("");

        count.textContent = `${items.length} / ${list.length}`;
      }

      function filter(){
        const q = (search.value || "").trim().toLowerCase();
        if (!q) return render(list);
        render(list.filter(x =>
          x.title.toLowerCase().includes(q) ||
          x.id.toLowerCase().includes(q)
        ));
      }

      search.addEventListener("input", filter);
      render(list);

      document.getElementById('modal').classList.add('active');
      document.body.style.overflow = 'hidden';

      if (list.length === 0) showToast(`‚ö†Ô∏è Aucun document dans "${title}" (cl√©: ${key})`);
    }

    function closeModal() {
      document.getElementById('modal').classList.remove('active');
      document.body.style.overflow = '';
    }

    // TOAST
    function showToast(message) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 3000);
    }

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') closeModal();
    });

    // ‚úÖ Gestion erreurs images => fallback
    document.querySelectorAll('img').forEach(img => {
      img.addEventListener('error', function () {
        console.warn('Image non trouv√©e:', this.getAttribute('src'));
        applyImageFallback(this);
      });
    });

    console.log('%cüß© Portail QHSE Les Mousquetaires', 'color: #E2001A; font-size: 20px; font-weight: bold;');
    console.log('%cBrignoles - Logistique & QHSE', 'color: #666; font-size: 12px;');
  </script>
</body>
</html>
